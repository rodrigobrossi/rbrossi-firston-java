<%
response.setHeader("Pragma", "no-cache");
if (request.getProtocol().equals("HTTP/1.1"))
  response.setHeader("Cache-Control", "no-cache");
%>

<%@page contentType="text/html" errorPage="/erro/ExceptionPage.jsp" %>
<%@page import="ser.comum.conexao.*, java.sql.*, java.lang.Math.*, java.util.*, java.text.*" %>


<%
request.getSession();
ser.comum.Traducao.Traducao trd  = (ser.comum.Traducao.Traducao)session.getAttribute("Traducao");
ser.comum.conexao.Conexao conexao  = (ser.comum.conexao.Conexao)session.getAttribute("Conexao");
ser.comum.param.param prm  = (ser.comum.param.param)session.getAttribute("Param");


String usu_tipo		= (String) session.getAttribute("usu_tipo"); 
String usu_nome		= (String) session.getAttribute("usu_nome"); 
String usu_login	= (String) session.getAttribute("usu_login"); 
Integer usu_fil 	= (Integer)session.getAttribute("usu_fil");  
Integer usu_idi		= (Integer)session.getAttribute("usu_idi"); 
Integer usu_codigo	= (Integer)session.getAttribute("usu_cod");

int pag = Integer.parseInt((String)session.getAttribute("pagina"));

ResultSet rs = null, rse = null;

String usu_plano = ""; 
usu_plano = usu_plano.valueOf(session.getAttribute("usu_plano")); 

String query="", ass="", tit="", cur="", ent="", inst="", durcur="", cuscur="", dtini_p="", dtfim_p="";

java.util.Date dataAtual = new java.util.Date();
SimpleDateFormat formato = new SimpleDateFormat("dd/MM/yyyy");
String dia = formato.format(dataAtual);

String moeda = prm.buscaparam("MOEDA");

//verifica dadas limite do plano
query = "SELECT PLA_DATAINICIO, PLA_DATAFINAL FROM PLANO WHERE PLA_CODIGO = " +usu_plano;
rs = conexao.executaConsulta(query,session.getId()+"RS");
if (rs.next()) {
  dtini_p = formato.format(rs.getDate(1)); //out.println(dtini_p);
  dtfim_p = formato.format(rs.getDate(2)); //out.println(dtfim_p);
}
if(rs!=null){
rs.close();
conexao.finalizaConexao(session.getId()+"RS");
}

//recupera os dados da pagina
String pag_assunto	= (request.getParameter("selectass")==null)?"":(String)request.getParameter("selectass");
String pag_curso	= (request.getParameter("curso")==null)?"":(String)request.getParameter("curso");
String pag_dtini	= (request.getParameter("txtdtinic")==null)?"":(String)request.getParameter("txtdtinic");
String pag_dtfim	= (request.getParameter("txtdtfim")==null)?"":(String)request.getParameter("txtdtfim");
String pag_cuscur	= (request.getParameter("txtcustocurso")==null)?"0":(String)request.getParameter("txtcustocurso");
String pag_cuslog	= (request.getParameter("txtcustolog")==null)?"0":(String)request.getParameter("txtcustolog");
String pag_duracao	= (request.getParameter("txtduracao")==null)?"":(String)request.getParameter("txtduracao");
String pag_duracao2 = (request.getParameter("txtduracao2")==null)?"":(String)request.getParameter("txtduracao2");
String pag_saratoga = (request.getParameter("sel_saratoga")==null)?"":(String)request.getParameter("sel_saratoga");
String pag_tipo		= (request.getParameter("sel_tipo")==null)?"":(String)request.getParameter("sel_tipo");
String pag_entidade = (request.getParameter("selectent")==null)?"":(String)request.getParameter("selectent");
String pag_instrutor= (request.getParameter("selectinst")==null)?"":(String)request.getParameter("selectinst");
String pag_obs 		= (request.getParameter("txtobs")==null)?"":(String)request.getParameter("txtobs");

//try {
%>

<%!
public String replaceString(String s, String busca, String troca)
{
	String nova = "";
	int ini = s.indexOf(busca);
	boolean ok = false;
	if (ini>0){
		ok = true;
		}
	else{
		nova = s;
		}
	while (ok) {
		int fim = busca.length();
		nova = s.substring(0,ini) + troca + s.substring(ini+fim,s.length());
		ini = nova.indexOf(busca);
		if (ini>0){
			s = nova;
			}
		else {
			ok = false;
			}
		}
	return nova;
	}
%>

<%
Vector vet_desc = new Vector();
Vector vet_cust = new Vector();

if(vet_desc.size()!=0) vet_desc.clear();
if(vet_cust.size()!=0) vet_cust.clear();

//limpa os vetores de custo
if (request.getParameter("limpa_vets") == null) {
    //out.println("LIMPOU");
    session.setAttribute("vet_descS",vet_desc);
    session.setAttribute("vet_custS",vet_cust);
}

//recupera da sessao os vetores de custo
if((Vector)session.getAttribute("vet_descS") != null)
    vet_desc = (Vector)session.getAttribute("vet_descS");
if((Vector)session.getAttribute("vet_custS") != null)
    vet_cust = (Vector)session.getAttribute("vet_custS");

//detela itens dos vetores de custo
String deleta = (request.getParameter("deleta_vets")==null)?"":(String)request.getParameter("deleta_vets");
if (deleta.equals("S")) {
    int t = vet_cust.size();
    String aux = "";
    for(int i=t;i>=0;i--) {
        if(request.getParameter("vet"+i) != null) {
            aux = request.getParameter("vet"+i);
            int novo = Integer.parseInt((String)aux);
            vet_desc.remove(novo);
            vet_cust.remove(novo);
            //out.println("EXCLUIU, i"+i+",t"+t);
        }
    }
}

//adiciona itens aos vetores de custo
String desc_logistica = (request.getParameter("txt_desc")==null)?"":(String)request.getParameter("txt_desc");
if(!desc_logistica.equals("")) {
    //out.println("ADICIONOU!!!");
    if(!(vet_desc.contains(request.getParameter("txt_desc")))) {
        vet_desc.addElement(request.getParameter("txt_desc"));
	if(request.getParameter("txt_cust") != null) {
            String xis = request.getParameter("txt_cust");
            //xis = replaceString(xis,"R$","");
            xis = replaceString(xis,".","");
            xis = replaceString(xis,",",".");
            vet_cust.addElement(xis);
	}
    }
}

request.getSession(true);
session.setAttribute("vet_descS",vet_desc);
session.setAttribute("vet_custS",vet_cust);
String descricao = "", custo = "", aux="", teste="";
//out.println("vet_desc"+ vet_desc);

float total = 0;
if(request.getParameter("total2") != null) {
    String m = request.getParameter("total2");
    total = Float.parseFloat(m);
}

String origem = "";
if(request.getParameter("origem") != null)
    origem = request.getParameter("origem");

//Busca e Insere dados no vetor de funcionArios
//Obs: o nome dos parametros dos codigos do registro deverao usar o formato: "checkbox" + numero sequencial (Ex: checkbox1, checkbox2)
String fun_codigo = ""; //Parametro quando funcionario for UNICO!!!
String contador  = "1";
if(request.getParameter("contador") != null)
    contador  = (String)request.getParameter("contador"); //contador do numero de funcionarios possiveis

//Busca e Insere dados no vetor de funcionArios selecionados
String n = "";
Vector funcvet = new Vector();
request.getSession();
funcvet = (Vector)session.getAttribute("funcs");
//insere os elementos no vetor
for(int k=0 ; k<=pag;k++) {
  if ((request.getParameter("checkbox" + n.valueOf(k)) != null)) {
    //out.println(request.getParameter("checkbox" + n.valueOf(k)));
    if (!(funcvet.contains(request.getParameter("checkbox" + n.valueOf(k)))))
      funcvet.add(request.getParameter("checkbox" + n.valueOf(k)));
  }
}

//out.println("VecTam: " + funcvet.size());
session.setAttribute("funcs",funcvet);
//funcvet.clear();
%>
<script language="JavaScript" src="/js/scripts.js"></script>
<script language="javascript">
function cancelar() {
    window.open("02_registrorapido.jsp","_parent");
}
function insere()
{
	if(frm.txt_desc.value === "")
	{
		var msg  = <%=("\""+trd.Traduz("DIGITE A DESCRICAO")+"\"")%> +""; 
		alert(msg);
		frm.txt_desc.focus();
		return false;
	}
	else if(frm.txt_cust.value === "")
	{
		alert(<%=("\""+trd.Traduz("DIGITE O CUSTO")+"\"")%>);
		frm.txt_cust.focus();
		return false;
	}
	else
	{
		frm.action="04_registrorapido.jsp";
		frm.submit();
		return true;
	}
}

function deleta() {
    var cont=0;
    for(i=0;i<frm.contador.value;i++) {
        if(eval("frm.vet"+i+".checked")==true) {
            cont = cont + 1;
	}
    }
    if(cont==0) {
        alert(<%=("\""+trd.Traduz("NENHUM ITEM SELECIONADO")+"\"")%>);
	return false;
    }
    else
    {
        if(confirm(<%=("\""+trd.Traduz("DESEJA EXCLUIR O ITEM SELECIONADO?")+"\"")%>)) {
            frm.deleta_vets.value = "S";
            frm.action="04_registrorapido.jsp";
            frm.submit();
            return true;
	}
	else
	return false;
    }
}

function enviar() 
{
    var data1 = document.frm.txtdtinic.value; //data inicial da tela
    var data2 = document.frm.txtdtfim.value; //data final da tela
    var data3 = "<%=dtini_p%>"; //data inicial do plano
    var data4 = "<%=dtfim_p%>"; //data final do plano
    i1=0; i2=0; i3=0; i4=0;
    while(i1<data1.length){
        i1++;
    }
    while(i2<data2.length){
	i2++;
    }
    while(i3<data3.length){
	i3++;
    }
    while(i4<data4.length){
	i4++;
    }
    if(data1.length==9)
	data1 ="0"+data1;
    if(data2.length==9)
	data2 ="0"+data2;
    if(data3.length==9)
	data3 ="0"+data3;
    if(data4.length==9)
	data4 ="0"+data4;

    var dia1 = data1.substring(0,2);
    var dia2 = data2.substring(0,2);
    var dia3 = data3.substring(0,2);
    var dia4 = data4.substring(0,2);
    var mes1 = data1.substring(3,5);
    var mes2 = data2.substring(3,5);
    var mes3 = data3.substring(3,5);
    var mes4 = data4.substring(3,5);
    var ano1 = data1.substring(6,10);
    var ano2 = data2.substring(6,10);
    var ano3 = data3.substring(6,10);
    var ano4 = data4.substring(6,10);    

    if (frm.curso.value == "") {
        alert(<%=("\""+trd.Traduz("Favor digitar o nome do curso!")+"\"")%>);
        frm.curso.focus();
    }
    else
    {
        if (frm.txtdtinic.value == "") {
        alert(<%=("\""+trd.Traduz("Favor digitar data inicial!")+"\"")%>);
        frm.txtdtinic.focus();
	}
	else
	{
            if (frm.txtdtfim.value == "") {
            alert(<%=("\""+trd.Traduz("Favor digitar data final!")+"\"")%>); 
            frm.txtdtfim.focus();
	    }
            else
            {
                if (frm.txtcustocurso.value == "") {
                alert(<%=("\""+trd.Traduz("Favor digitar custo do curso!")+"\"")%>); 
                frm.txtcustocurso.focus();
		}
		else
		{
                    if (frm.txtcustolog.value == "") {
                    alert(<%=("\""+trd.Traduz("Favor digitar custo de logistica!")+"\"")%>); 
                    frm.txtcustolog.focus();
                    }
                    else
                    {
                        if (frm.txtduracao.value == "" || frm.txtduracao2.value == "") {
                        alert(<%=("\""+trd.Traduz("Favor digitar duracao (hh:mm) do curso!")+"\"")%>); 
                        frm.txtduracao.focus();
			}
			else
			{					
			    if(<%=("\""+prm.buscaparam("USE_SARATOGA")+"\"")%> == "S" && frm.sel_saratoga.value == ""){
                            alert(<%=("\""+trd.Traduz("Favor escolher saratoga!")+"\"")%>); 
                            frm.sel_saratoga.focus();
                            }
                            else
                            {        
                                if (frm.selectent.value == "") {
                                alert(<%=("\""+trd.Traduz("Favor escolher entidade!")+"\"")%>); 
                                frm.selectent.focus();
                                }
                                else
                                {        
                                    if (frm.sel_tipo.value == "") {
                                    alert(<%=("\""+trd.Traduz("Favor escolher o tipo!")+"\"")%>); 
                                    frm.sel_tipo.focus();
                                    }
                                        else
                                        {
                                            if(ano1>ano2){
                                                alert(<%=("\""+trd.Traduz("A data final nAo pode ser menor que a data de inicial")+"\"")%>);
                                                document.frm.txtdtfim.value="";
                                                document.frm.txtdtfim.focus();
                                                return false;	
                                            }
                                            else if(ano1==ano2){
                                                if (mes1>mes2){
                                                    alert(<%=("\""+trd.Traduz("A data final nAo pode ser menor que a data de inicial")+"\"")%>);
                                                    document.frm.txtdtfim.value="";
                                                    document.frm.txtdtfim.focus();
                                                    return false;	
                                                }
                                                else if(mes1==mes2){
                                                    if(dia1>dia2){	
                                                        alert(<%=("\""+trd.Traduz("A data final nAo pode ser menor que a data de inicial")+"\"")%>);
                                                        document.frm.txtdtfim.value="";
                                                        document.frm.txtdtfim.focus();
                                                        return false;	
                                                    }
                                                }
                                                if(ano1<ano3 || ano1>ano4){
                                                        alert(<%=("\""+trd.Traduz("A data inicial/final estA fora do perIodo do plano")%> ("+data3+ " - " +data4+")!");
                                                        document.frm.txtdtinic.value="";
                                                        document.frm.txtdtinic.focus();
                                                        document.frm.txtdtfim.value="";
                                                        document.frm.txtdtfim.focus();
                                                        return false;	
                                                    }
                                                    else if(ano1==ano3){
                                                        if (mes1<mes3 || mes1>mes4){
                                                            alert(<%=("\""+trd.Traduz("A data inicial/final estA fora do perIodo do plano")%> ("+data3+ " - " +data4+")!");
                                                            document.frm.txtdtinic.value="";
                                                            document.frm.txtdtinic.focus();
                                                            document.frm.txtdtfim.value="";
                                                            document.frm.txtdtfim.focus();
                                                            return false;	
                                                        } else if((dia1<dia3 && mes1==mes3) || (dia2>dia4 && mes2==mes4)){
                                                                alert(<%=("\""+trd.Traduz("A data inicial/final estA fora do perIodo do plano")+"\"")%> ("+data3+ " - " +data4+") + "!");
                                                                document.frm.txtdtinic.value("");
                                                                document.frm.txtdtinic.focus();
                                                                document.frm.txtdtfim.value("");
                                                                document.frm.txtdtfim.focus();
                                                                return false;
                                                            };
                                                    }
                                            }
                                            frm.action = "04_registrorapido_grava.jsp";
                                            frm.submit();
                                            return false; 
                                        }
                                    }
                            }
                        }
                    }
                }
            }
        }
    }
}

function duracao(campo){
	aux = campo.value;
	tam = aux.length
	aux2 = aux.substring(tam-1,tam);
	if(aux2 != "0" && aux2 != "1" && aux2 != "2" && aux2 != "3" && aux2 != "4" &&
	   aux2 != "5" && aux2 != "6" && aux2 != "7" && aux2 != "8" && aux2 != "9"){
		aux = campo.value;
		aux = aux.length;
		aux = aux - 1;
		pal = campo.value;
		campo.value = pal.substring(0, aux);
	}

}
function duracao2(campo){
	aux = campo.value;
	tam = aux.length;
	i = 0;
	nova = "";
	while(i != tam){
		aux2 = aux.substring(i,i+1);
		if(aux2 != "0" && aux2 != "1" && aux2 != "2" && aux2 != "3" && aux2 != "4" &&
	   		aux2 != "5" && aux2 != "6" && aux2 != "7" && aux2 != "8" && aux2 != "9"){
			nova = nova;
		}
		else{
			nova = nova + aux2;
		}
		i++;
		
	}
	campo.value = nova;
}


function numero(campo){
	aux = campo.value;
	tam = aux.length
	aux2 = aux.substring(tam-1,tam);
	if(aux2 != "0" && aux2 != "1" && aux2 != "2" && aux2 != "3" && aux2 != "4" && aux2 != "," &&
	   aux2 != "5" && aux2 != "6" && aux2 != "7" && aux2 != "8" && aux2 != "9"){
		aux = campo.value;
		aux = aux.length;
		aux = aux - 1;
		pal = campo.value;
		campo.value = pal.substring(0, aux);
	}
}

function numero2(){
	aux = frm.txtcustocurso.value;
	tam = aux.length;
	k = 0;
	v = 0;
	if(tam == 1){
		aux2 = aux.substring(tam-1,tam);
		if(aux2 == ","){
			frm.txtcustocurso.value = "";
		}
	}
	while(tam>0){
		aux2 = aux.substring(tam-1,tam);
		if(aux2 != "0" && aux2 != "1" && aux2 != "2" && aux2 != "3" && aux2 != "4" && aux2 != "," &&
		   aux2 != "5" && aux2 != "6" && aux2 != "7" && aux2 != "8" && aux2 != "9"){
			k = k+1;
		}
		if(aux2 == ","){
			v = v + 1;
		}
		tam--;
	}
	if(k != 0 || v > 1){
		alert(<%=("\""+trd.Traduz("FORMATO INVALIDO")+"\"")%>);
		frm.txtcustocurso.value = "";
		frm.txtcustocurso.focus();
	}
	atualiza();
}

function numero3(campo){
	aux = campo.value;
	tam = aux.length;
	k = 0;
	v = 0;
	if(tam == 1){
		aux2 = aux.substring(tam-1,tam);
		if(aux2 == ","){
			campo.value = "";
		}
	}
	while(tam>0){
		aux2 = aux.substring(tam-1,tam);
		if(aux2 != "0" && aux2 != "1" && aux2 != "2" && aux2 != "3" && aux2 != "4" && aux2 != "," &&
		   aux2 != "5" && aux2 != "6" && aux2 != "7" && aux2 != "8" && aux2 != "9"){
			k = k+1;
		}
		if(aux2 == ","){
			v = v + 1;
		}
		tam--;
	}
	if(k != 0 || v > 1){
		alert(<%=("\""+trd.Traduz("FORMATO INVALIDO")+"\"")%>);
		campo.value = "";
		campo.focus();
	}
}

function atualiza() {
    //numero2();
    aux = frm.txtcustocurso.value;
    tam = aux.length;
    var nova = "";
    for(i=0;i<tam;i++){
    	aux2 = aux.charAt(i);
    	if(aux2 == ","){
    		aux2 = ".";
    		nova = nova + aux2;
    	}
    	else if(aux2 == "."){
    		nova = nova;
    	}
    	else{
    		nova = nova + aux2;
    	}
    }
	var c1 = nova;
	
    aux = frm.txtcustolog.value;
    tam = aux.length;
    var nova = "";
    for(i=0;i<tam;i++){
    	aux2 = aux.charAt(i);
    	if(aux2 == ","){
    		aux2 = ".";
    		nova = nova + aux2;
    	}
    	else if(aux2 == "."){
    		nova = nova;
    	}
    	else{
    		nova = nova + aux2;
    	}
    }
	var c2 = nova;
    var total = eval(c1+"+"+c2);
    
    frm.txtcustoreal.value = total;
    aux = frm.txtcustoreal.value;
    tam = aux.length;
    var nova = "";
    for(i=0;i<tam;i++){
    	aux2 = aux.charAt(i);
    	if(aux2 == "."){
	   		aux2 = ",";
    		nova = nova + aux2 + aux.charAt(i+1) + aux.charAt(i+2);
    		i = tam;
    	}
    	else{
    		nova = nova + aux2;
    	}
    }
    frm.txtcustoreal.value = nova;
}

function FormataData(campo, evento, direcao){
	if (campo.value.length < 10000){
		if (evento != 9 ){//tab
			if(evento != 8 && evento != 46 && evento != 16 && !(evento > 36 && evento < 41)){ //delete, backspace, shift nAo causam evento
				var tam = campo.value.length
				if ((evento >= 48 && evento <= 57) || (evento >= 96 && evento <= 105)) {
					if (tam == 2 || tam == 5){
						campo.value = campo.value + "/";
						}
					} 
				else{
					if (direcao == "up"){
						if (campo.value.length == 0){
							campo.value = ""
							}
						else{
							campo.value = campo.value.substring(0,campo.value.length-1)
							}
						}
					}
				campo.focus()
				}
			} 
		else{
			if (direcao == "down"){
				ChecaData(campo)
				}
			}
		}
	}


function ChecaData(THISDATE){
	var erro = 0
	var data = THISDATE.value
	if (data.length != 10) 
		erro=1
	var dia = data.substring(0, 2)// dia
	var barra1 = data.substring(2, 3)// '/'
	var mes = data.substring(3, 5)// mes
	var barra2 = data.substring(5, 6)// '/'
	var ano = data.substring(6, 10)// ano
		
	if (mes < 1 || mes > 12) 
		erro = 1
	if (dia < 1 || dia > 31) 
		erro = 1
	if (ano < 1990) 
		erro = 1
	if (mes == 4 || mes == 6 || mes == 9 || mes == 11){
		if (dia == 31) 
			erro = 1
			}
	if (mes == 2){
		var bis = parseInt(ano/4)
		if (isNaN(bis)){
			erro = 1
			}
		if (dia > 29) 
			erro = 1
		if (dia == 29 && ((ano/4) != parseInt(ano/4))) 
			erro = 1
		}
	if ((erro == 1) && (THISDATE.value != "")) {
		alert(THISDATE.value + ' <%=trd.Traduz("E uma data invAlida!")%>');
		THISDATE.value = "";
		}
	}

function DoCal(elTarget){
	if (showModalDialog){
		var sRtn;
		sRtn = showModalDialog("calendar.htm","","center=yes;status=no;dialogWidth=306px;dialogHeight=220px");
		if (sRtn!="")
			elTarget.value = sRtn;
		} 
	else
		alert(<%=("\""+trd.Traduz("INTERNET EXPLORER 4.0 OU SUPERIOR E NECESSARIO")+"\"")%>)
}

function FormataCampo(campo, evento, direcao){
    //alert(evento);
    aux = campo.value;
    aux = aux.length;
    aux = aux - 1;
    pal = campo.value;
	if (campo.value.length < 1000000){
		if(evento != 9 ){//tab
			if(evento != 8 && evento != 46 && evento != 16 && !(evento > 36 && evento < 41) && evento!=190 && evento!=110 && evento!=194){ //delete, backspace, shift nAo causam evento
				var tam = campo.value.length
				if ((evento >= 48 && evento <= 57) || (evento >= 96 && evento <= 105)){
					if (tam == 2 || tam == 5){
						campo.value = campo.value + "";
					}
				}
				else{
					if (direcao == "up"){
						if (campo.value.length == 0){
                                                        //campo.value = pal.substring(0, aux);
							campo.value = ""
						}
						else{
                                                        //campo.value = pal.substring(0, aux);
							campo.value = "";//campo.value.substring(0,campo.value.length-1)
						}
					}
				}
				campo.focus()
			}
			else if(evento == 16){
                                //campo.value = pal.substring(0, aux);
				campo.value="";
			}

		} 
		else{
			if (direcao == "down"){
				var teste = campo.value.substring(0,1);
				if(campo.value<0){
					alert(<%=("\""+trd.Traduz("Este campo nAo aceita valores negativos !")+"\"")%>);
                                        //campo.value = pal.substring(0, aux);
					campo.value="";
					campo.focus();
					return false;
				}
				else if(teste=="-"||teste=="+"||teste=="~"||teste=="^"||
					teste=="\""||teste=="'"||teste=="!"||teste=="@"||
					teste=="#"||teste=="$"||teste=="%"||teste=="¨"||
					teste=="&"||teste=="*"||teste=="("||teste==")"||
					teste=="_"||teste=="="||teste=="~"||teste=="`"||
					teste=="´"||teste=="{"||teste=="["||teste=="}"||
					teste=="]"||teste=="<"||
					teste==">"||teste==":"||teste==";"||teste=="/"||
					teste=="?"||teste=="|"||teste=="\\"||teste=="^"){
					alert(<%=("\""+trd.Traduz("Este campo nAo aceita caracteres especiais !")+"\"")%>);
                                        //campo.value = pal.substring(0, aux);
					campo.value="";
					campo.focus();
					return false;
				}
			}
		}
	}
	//formataReal(campo);
}

function aspa(campo){
	aux = campo.value;
	tam = aux.length
	aux2 = aux.substring(tam-1,tam);
	if(aux2 == "\"" || aux2 == "\'"){
		aux = campo.value;
		aux = aux.length;
		aux = aux - 1;
		pal = campo.value;
		campo.value = pal.substring(0, aux);
	}
}

function aspa2(campo){
	aux = campo.value;
	tam = aux.length;
	i = 0;
	nova = "";
	while(i != tam){
		aux2 = aux.substring(i,i+1);
		if(aux2 == "\"" || aux2 == "\'")
			nova = nova;
		else
			nova = nova + aux2;
		i++;
		
	}
	campo.value = nova;
}

function atualiza_cbo() {
    frm.action = "04_registrorapido.jsp";
    frm.submit();
}

function validaData(){
    var data1 = document.frm.txtdtini.value;
    var data2 = document.frm.txtdtfim.value;
    i1=0;
    i2=0;
    while(i1<data1.length){
        i1++;
    }
    while(i2<data2.length){
	i2++;
    }
    if(data1.length==9)
	data1 ="0"+data1;
    if(data2.length==9)
	data2 ="0"+data2;
	
    var dia1 = data1.substring(0,2);
    var dia2 = data2.substring(0,2);
    var mes1 = data1.substring(3,5);
    var mes2 = data2.substring(3,5);
    var ano1 = data1.substring(6,10);
    var ano2 = data2.substring(6,10);
	
    if(ano1>ano2){
        alert(<%=("\""+trd.Traduz("A data final nAo pode ser menor que a data de inicial")+"\"")%>);
	document.frm.txtdtfim.value="";
	document.frm.txtdtfim.focus();
	return false;	
    }
    else if(ano1<ano2 || ano1==ano2){
        if (mes1>mes2){
            alert(<%=("\""+trd.Traduz("A data final nAo pode ser menor que a data de inicial")+"\"")%>);
            document.frm.txtdtfim.value="";
            document.form_pro_cli.pro_fim.focus();
            return false;	
	}
	else if(mes1==mes2){
            if(dia1>dia2){	
                alert(<%=("\""+trd.Traduz("A data final nAo pode ser menor que a data de inicial")+"\"")%>);
                document.frm.txtdtfim.value="";
		document.frm.txtdtfim.focus();
		return false;	
            }
            else
            {
                return true; 
            }
	}
	else{
            return true; 
	} 	
    }		
} 
</script>
<html>

<%! public String durhora(float valor){
	int ho = 0;
	Float h;
	h = new Float(valor);;
	ho = h.intValue();
	ho = ho / 60;
	String hora = "";
	hora = hora.valueOf(ho);
	return hora;
}
%>

<%! public String durmin(float valor){
	int mi =0;
	Float m;
	m = new Float(valor);
	mi = m.intValue();
	mi = mi % 60;
	String min = "";
	if(mi < 10){
		min = "0"+min.valueOf(mi);
	}
	else{
		min = min.valueOf(mi);
	}
	return min;
}
%>

<%!
public String ReaistoStr(float valor)
{
DecimalFormat dcf = new DecimalFormat("0.00");
dcf.setMaximumFractionDigits(2);
String strReais = dcf.format(valor);
return strReais;
}
%>

<%!
public String ReaistoStr2(float valor, String moeda){
	DecimalFormat dcf = new DecimalFormat("0.00");
	dcf.setMaximumFractionDigits(2);
	String strReais = dcf.format(valor);
	return moeda + strReais;
}
%>

<head>
<title>FirstOn - <%=trd.Traduz("Registro")%> - <%=trd.Traduz("Registrar Registro RApido")%></title>
<script language="JavaScript" src="/js/scripts.js"></script>
<link rel="stylesheet" href="../default.css" type="text/css">
</head>

<body  onunload='return fecha();'  leftmargin="0" topmargin="0" marginwidth="0" marginheight="0" onLoad="MM_preloadImages('../art/ico_home_on.gif','../art/ico_mensagens_on.gif','../art/ico_batepapo_on.gif','../art/ico_anotacoes_on.gif','../art/ico_listadecursos_on.gif','../art/ico_glossario_on.gif','../art/ico_ajuda_on.gif','art/onenglish.gif','art/onespanol.gif')">
<table width="100%" border="0" cellspacing="0" cellpadding="0" height="100%">
  <tr> 
    <td valign="top"> 
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td height="59" class="hcfundo"> 
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
              <tr> 
<%	      String ponto = (String)session.getAttribute("barra");
	      if(ponto.equals("..")){%>
               <jsp:include page="../menu/banner.jsp" flush="true"><jsp:param value="opt" name="RG"/></jsp:include> 
<%            }else{%>
               <jsp:include page="/menu/banner.jsp" flush="true"><jsp:param value="opt" name="RG"/></jsp:include> 
<%            }%>
              </tr>
            </table>
          </td>
        </tr>
        <tr> 
          <td class="mnfundo"><img src="../art/bit.gif" width="12" height="5"></td>
        </tr>
        <tr> 
          <td height="25" class="mnfundo"> 
            <table border="0" cellspacing="0" cellpadding="0">
              <tr> 
                <%String oi = "", oia = "";
                  if(ponto.equals("..")){
				if (request.getParameter("op") == null)
				{
                  oi = "../menu/menu.jsp?op="+"R";
				}
				else
				{
                  oi = "../menu/menu.jsp?op="+request.getParameter("op");
				}
				if (request.getParameter("opt") == null)
				{
                  oia = "../menu/menu1.jsp?opt="+"RR";
				} 
				else
				{  
                  oia = "../menu/menu1.jsp?opt="+request.getParameter("opt");
				}
		} else {
		if (request.getParameter("op") == null)
						{
		                  oi = "/menu/menu.jsp?op="+"R";
						}
						else
						{
		                  oi = "/menu/menu.jsp?op="+request.getParameter("op");
						}
						if (request.getParameter("opt") == null)
						{
		                  oia = "/menu/menu1.jsp?opt="+"RR";
						} 
						else
						{  
		                  oia = "/menu/menu1.jsp?opt="+request.getParameter("opt");
				}
		}%>
                <jsp:include page="<%=oi%>" flush="true"></jsp:include>
              </tr>
            </table>
          </td>
        </tr>
        <jsp:include page="<%=oia%>" flush="true"></jsp:include>
      </table>
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td width="20">&nbsp;</td>
          <td width="100%" align="center"> 
            <table border="0" cellspacing="0" cellpadding="0">
              <tr> 
                <td width="13"><img src="../art/bit.gif" width="13" height="15"></td>
                <td class="trontrk" align="center"><%=trd.Traduz("REGISTRAR REGISTRO RAPIDO")%></td>
                <td width="29"><img src="../art/bit.gif" width="13" height="15"></td>
              </tr>
            </table>
          </td>
          <td width="20">&nbsp;</td>
        </tr>
        <tr> 
          <td width="20" height="1"><img src="../art/bit.gif" width="1" height="1"></td>
          <td valign="top" class="ctvdiv"><img src="../art/bit.gif" width="1" height="1"></td>
          <td width="20"><img src="../art/bit.gif" width="1" height="1"></td>
        </tr>
	<FORM name="frm" method="post">
        <tr> 
          <td width="20" valign="top"></td>
          <td valign="top"> <img src="../art/bit.gif" width="159" height="1">&nbsp;
            <br>
              <center>
                <table border="0" cellspacing="2" cellpadding="2" width="80%">
                  <tr> 
				  
			        <td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Curso")%>:</td>
                    <td class="ftverdanacinza" colspan="6"> 
                      <input type="text" name="curso" size="68" value="<%=pag_curso%>" onKeyUp="aspa(this)" onBlur="aspa2(this)">
                    </td>

                    
                  </tr>
                  <tr> 
                  <td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Assunto")%>:</td>
                    <td class="ftverdanacinza" colspan="6"> 
                      <select name="selectass">
                      	<option value=""><%=trd.Traduz("SELECIONE")%></option>
<%                      //devido a necessidade do registro rapido gravar um curso e um curso precisa de um titulo,
                        //esse combo lista somente os assuntos que possuem titulos atribuidos
                        query = "SELECT DISTINCT A.ASS_CODIGO, A.ASS_NOME FROM ASSUNTO A, TITULO T " +
                                "WHERE A.ASS_ATIVO = 'S' AND A.ASS_CODIGO = T.ASS_CODIGO ORDER BY ASS_NOME";
                        rs = conexao.executaConsulta(query,session.getId());
                        if (rs.next()) {
                         do { 
                           if (pag_assunto.equals(rs.getString(1))) {%>
                             <option value = "<%=rs.getInt(1)%>" selected><%=rs.getString(2)%></option>  
                           <%} else {%>					  
                             <option value = "<%=rs.getInt(1)%>"><%=rs.getString(2)%></option>  
                           <%}
		         }
                         while (rs.next());
		        } 
                        if(rs!=null){
                            rs.close();
                            conexao.finalizaConexao(session.getId());
                            }    
                        %>
                      </select>
                    </td>
                  </tr>
                  <tr> 
                    
                  </tr>
                  <tr> 
                    <td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Data Inicial")%>:</td>
                    <td class="ftverdanacinza"> 
                      <input type="text" name="txtdtinic" size="9" value="<%=pag_dtini%>" onChange="ChecaData(this)" onKeyDown="FormataData(this, window.event.keyCode,'down')" onKeyUp="FormataData(this, window.event.keyCode,'up')">
		      &nbsp;<img onclick="DoCal(txtdtinic)" style="cursor:hand" src="../art/icon_cal.gif" title="CalendArio" WIDTH="17" HEIGHT="16"> 
                    </td>
                    <td class="ftverdanacinza" nowrap align="right"><%=trd.Traduz("Data Final")%>:</td>
                    <td class="ftverdanacinza" colspan="4"> 
                      <input type="text" name="txtdtfim" size="9" value="<%=pag_dtfim%>" onChange="ChecaData(this)" onKeyDown="FormataData(this, window.event.keyCode,'down')" onKeyUp="FormataData(this, window.event.keyCode,'up')">
		      &nbsp;<img onclick="DoCal(txtdtfim)" style="cursor:hand" src="../art/icon_cal.gif" title="CalendArio" WIDTH="17" HEIGHT="16"> 
                    </td>
                  </tr>
                  <tr> 
                    <td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Custo Curso")%>:  <%=moeda%></td>
                    <td class="ftverdanacinza" colspan="2" nowrap>
					<%
		    		int i=0;
		    		total=0;
		    		while(i < vet_cust.size()){
                        aux = (String)vet_cust.elementAt(i); 
		    			float nova = Float.parseFloat(aux);
		    			total = total + nova;
		    			i=i+1;
		    		}
		    		%>
                    <input type="text" name="txtcustocurso" size="10" value="<%=pag_cuscur%>" onKeyUp="numero(this)" onblur="numero2();">
                    (99999,99) + <%=trd.Traduz("Custo LogIstica")%>:  <%=moeda%></td>
                    <td class="ftverdanacinza"> 
                      <input readonly type="text" name="txtcustolog" size="10" value="<%=ReaistoStr(total)%>" onblur="atualiza();" onKeyDown="FormataCampo(this, window.event.keyCode,'down')" onKeyUp="FormataCampo(this, window.event.keyCode,'up')">
                    </td>
                    <td class="ftverdanacinza" nowrap>= <%=trd.Traduz("Custo Real")%>:  <%=moeda%> </td>
                    <td class="ftverdanacinza" colspan="2"> 
					<%
					pag_cuscur = replaceString(pag_cuscur,",",".");
					float custo_final = Float.parseFloat(pag_cuscur) + total;
					
					%>
                      <input readonly type="text" name="txtcustoreal" size="10" maxlength="50" onblur="atualiza();" value="<%=ReaistoStr(custo_final)%>" onKeyDown="FormataCampo(this, window.event.keyCode,'down')" onKeyUp="FormataCampo(this, window.event.keyCode,'up')">
                    </td>
                  </tr>				 
                  <tr> 
                    <td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("DURACAO")%>:</td>
                    <td class="ftverdanacinza" colspan="6"> 
                      <input type="text" name="txtduracao" size="2" value="<%=pag_duracao%>" onBlur="duracao2(this)" onKeyUp="duracao(this)">:<input type="text" name="txtduracao2" size="2" maxlength="2" value="<%=pag_duracao2%>" onBlur="duracao2(this)" onKeyUp="duracao(this)">  hh:mm
                      &nbsp; &nbsp; &nbsp; 
<%                    String use_saratoga = prm.buscaparam("USE_SARATOGA");
                      if(use_saratoga.equals("S")) {%>
                	<%=trd.Traduz("CLASSIFICACAO SARATOGA")%>:                     
                       	<select name="sel_saratoga">
                       	<option value = ""><%=trd.Traduz("Selecione")%></option>
<%			query = "SELECT SAR_CODIGO, SAR_DESCRICAO FROM SARATOGA ORDER BY SAR_DESCRICAO";
                       	rs = conexao.executaConsulta(query,session.getId()+"RS_3");
                       	if (rs.next()){
                            do{
                                if(pag_saratoga.equals(rs.getString(1))){%> 
                                    <option value="<%=rs.getInt(1)%>" selected><%=rs.getString(2)%></option> 
<%				} else {%>
                                    <option value="<%=rs.getInt(1)%>"><%=rs.getString(2)%></option> 
<%				}
                            } while(rs.next());
                        }
                        if(rs!=null){
                        rs.close();
                        conexao.finalizaConexao(session.getId()+"RS_3");
                        }
                        %>
                        </select>
<%                    }%>
                    </td>
                  </tr>
                  <tr>					
                    <td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Entidade")%>:</td>
                    <td class="ftverdanacinza" colspan="6"> 
                      <select name="selectent" onchange="atualiza_cbo();">
                      <option value=""><%=trd.Traduz("Selecione")%></option>
<%                     /*query = "SELECT DISTINCT E.EMP_CODIGO, E.EMP_NOME FROM EMPRESA E, INSTRUTOR I " +
                               "WHERE E.EMP_CODIGO = I.EMP_CODIGO ORDER BY E.EMP_NOME"; */ 
						//Aqui fazia uma Join para pegar somente as Entidades que tinham Instrutor cadastrado 

					   query = "SELECT EMP_CODIGO, EMP_NOME FROM EMPRESA where emp_tipo <> 2 " +
                               "ORDER BY EMP_NOME";

                       rse = conexao.executaConsulta(query,session.getId()+"RS_4");
                       if (rse.next()) {
                         do {
                            if (pag_entidade.equals(rse.getString(1))){%>
                                <option value="<%=rse.getInt(1)%>" selected><%=rse.getString(2)%></option>  
<%                          } else {%>
                                <option value="<%=rse.getInt(1)%>"><%=rse.getString(2)%></option>  
<%                          }
			 } while (rse.next());
		       }
                       if(rse!=null){
                        rse.close();
                        conexao.finalizaConexao(session.getId()+"RS_4");
                        } 
                        %>                        
                      </select>
                      &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;<%=trd.Traduz("TIPO")%>: 
                      <select name="sel_tipo">
    			<option value=""><%=trd.Traduz("Selecione")%></option>
<%			query = "SELECT TCU_CODIGO, TCU_NOME FROM TIPOCURSO ORDER BY TCU_NOME";
			rs = conexao.executaConsulta(query,session.getId()+"RS_5");
			if (rs.next()) {
                            do {
                                if (pag_tipo.equals(rs.getString(1))) {%> 
                                    <option value="<%=rs.getInt(1)%>" selected><%=rs.getString(2)%></option> 
<%                              } else {%>
                                    <option value="<%=rs.getInt(1)%>"><%=rs.getString(2)%></option>
<%                              }
			    } while(rs.next());
			}
                        if(rs!=null){
                            rs.close();
                            conexao.finalizaConexao(session.getId()+"RS_5");
                            }
                        %>
                      </select>
                    </td>
                  </tr>
                  <tr> 
                    <td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Instrutor")%>:</td>
                    <td class="ftverdanacinza" colspan="6"> 
                      <select name="selectinst">
<%                     if (pag_entidade.equals("")) {%>
                            <option value=""><%=trd.Traduz("Selecione a entidade")%></option>
<%                     } else {%>
                            <option value=""><%=trd.Traduz("Selecione")%></option>
<%                          query = "SELECT INS_CODIGO, INS_NOME FROM INSTRUTOR WHERE EMP_CODIGO = " +pag_entidade+ " ORDER BY INS_NOME";
                            rs = conexao.executaConsulta(query,session.getId()+"RS_7"); 
                            if (rs.next()) {
                                do {
                                    if (pag_instrutor.equals(rs.getString(1))) {%>
                                        <option value="<%=rs.getInt(1)%>" selected><%=rs.getString(2)%></option>
<%                                  } else {%>
                                        <option value = "<%=rs.getInt(1)%>"><%=rs.getString(2)%></option>  
<%                                  }
                                } while (rs.next());
                            }
                       }
                        if(rs!=null){
                          rs.close();
                          conexao.finalizaConexao(session.getId()+"RS_7");
                        }
                        %>  
                      </select>
                    </td>
                  </tr>
                  <tr> 
                    <td class="ftverdanacinza" align="right"><%=trd.Traduz("OBSERVACAO")%>:</td>
                    <td class="ftverdanacinza" colspan="6"> 
                      <textarea name="txtobs" rows="4" cols="50" onKeyUp="aspa(this)" onBlur="aspa2(this)"><%=pag_obs%></textarea>
                    </td>
                  </tr>
                   <tr> 
                    <td class="ftverdanacinza" align="center" colspan="7">&nbsp;<br>
                      <input type="button" onClick="return enviar();" value=<%=("\""+trd.Traduz("Confirmar")+"\"")%> class="botcin" name="button">
					  &nbsp;&nbsp;
                      <input type="button" onClick="return cancelar();" value=<%=("\""+trd.Traduz("Cancelar")+"\"")%> class="botcin" name="button">
                    </td>
                  </tr>
                   <tr> 
                    <td class="ftverdanacinza" align="center" colspan="7"><hr></td>
                  </tr>
                </table>
                <table border="0" cellspacing="0" cellpadding="0" width="100%">
                  <tr align="center" valign="middle">
                    <td>
                      <table border="0" cellspacing="0" cellpadding="0" width="100%">
                        <tr>
                          <td valign="middle" class="trontrk" align="center"><%=trd.Traduz("CADASTRO DE CUSTO LOGISTICA")%></td>
                        </tr>
                        <tr align="center">
                          <td valign="top">
                            &nbsp;&nbsp;&nbsp;
                            <font class="ftverdanacinza"><%=trd.Traduz("DESCRICAO")%>:</font>
                            <input type="text" name="txt_desc" size="50" onKeyUp="aspa(this)" onBlur="aspa2(this)">
                            &nbsp;&nbsp;&nbsp;
                            <font class="ftverdanacinza"><%=trd.Traduz("CUSTO LOGISTICA")%>: <%=moeda%></font>
                            <input type="text" name="txt_cust" size="10" onKeyUp="numero(this)" onblur="numero3(this);">
                            <font class="ftverdanacinza">(99999,99)</font>
                            <br>
                            <center>
                              <input class="botcin" type="button" value=<%=("\""+trd.Traduz("INCLUIR")+"\"")%> OnClick="return insere();">
                              <input class="botcin" type="button" value=<%=("\""+trd.Traduz("EXCLUIR")+"\"")%> OnClick="return deleta(<%=origem%>);">
                            </center>
                    	    &nbsp;&nbsp;&nbsp;
                            <!--<center>-->
                              <table border="0" cellspacing="1" cellpadding="0" width="80%">
                                <tr>
                                  <td>&nbsp;</td>
                                  <td class="celtittab" width="80%">&nbsp;<%=trd.Traduz("DESCRICAO")%></td>
                                  <td class="celtittab" align="center" width="20%"><%=trd.Traduz("CUSTO")%></td>
                                </tr>
<%                              //out.println(""+vet_cust);
                                //out.println(""+vet_desc);
                                int a = 0;
                                while(a<vet_cust.size()) {
                                  aux = (String)vet_cust.elementAt(a);
                                  float novo = Float.parseFloat(aux);%>
                                  <tr>
                                    <td class="celnortab" align="center">
                                      <input name="vet<%=a%>" type="checkbox" value="<%=a%>">
                                    </td>
                                    <td class="celnortab">&nbsp;<%=vet_desc.elementAt(a)%></td>
                                    <td class="celnortab" align="right"><%=ReaistoStr2(novo, moeda)%></td>
                                  </tr>
<%                                a=a+1;
                                }%>
                                <tr>
                                  <td colspan="3" valign="top" class="ctvdiv"><img src="../art/bit.gif" width="1" height="1"></td>
                                </tr>
                                <tr>
                                  <td class="celnortab">&nbsp;</td>
                                  <td align="right" class="celnortab"><b><%=trd.Traduz("VALOR TOTAL")%>:&nbsp;</b></td>
                                  <td align="right" class="celnortab"><%=ReaistoStr2(total, moeda)%></td>
                                </tr>	
                                <tr><td>&nbsp;</td></tr>
                              </table>
                            <!--</center>-->
                          </td>
                        </tr>
                      </table>
                    </td>
                  </tr>
                </table>
              <!--</center>-->
              <input type="hidden" name="total2" value="<%=total%>">
              <input type="hidden" name="contador" value="<%=a%>">
              <input type="hidden" name="origem" value="2">
              <input type="hidden" name="limpa_vets" value="N">
              <input type="hidden" name="deleta_vets" value="N">
              <input type="hidden" name="log" value="S">
          </td>
        </tr>
	</form>
      </table>
    </td>
  </tr>
  <script language="JavaScript1.1" >
    document.frm.txt_desc.focus();
  </script>
  <tr> 
    <td align="right" height="30" class="difundo"> 
      <table width="100%" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td> 
<%          if(ponto.equals("..")){%>
                <jsp:include page="../rodape/rodape.jsp" flush="true"></jsp:include>
<%          }else{%>	  
                <jsp:include page="/rodape/rodape.jsp" flush="true" ></jsp:include>
   <%          }%>
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
</body>
</html>
