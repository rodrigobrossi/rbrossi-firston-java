
<%
response.setHeader("Pragma", "no-cache");
if (request.getProtocol().equals("HTTP/1.1")) {
  response.setHeader("Cache-Control", "no-cache");
}
%>

<%@page contentType="text/html" errorPage="/erro/ExceptionPage.jsp"%>
<%@page
	import="ser.comum.conexao.*,java.sql.*,java.lang.Math.*,java.util.*,java.text.*"%>
<html>
<head>
<title>FirstOn - <%=trd.Traduz("Registro")%> - <%=trd.Traduz("Registrar Lista de PresenCa")%></title>
<script language="JavaScript" src="/js/scripts.js"></script>
<link rel="stylesheet" href="../default.css" type="text/css">
</head>
<body onunload='return fecha();' leftmargin="0" topmargin="0"
	marginwidth="0" marginheight="0"
	onLoad="MM_preloadImages('../art/ico_home_on.gif','../art/ico_mensagens_on.gif','../art/ico_batepapo_on.gif','../art/ico_anotacoes_on.gif','../art/ico_listadecursos_on.gif','../art/ico_glossario_on.gif','../art/ico_ajuda_on.gif','art/onenglish.gif','art/onespanol.gif')">
<FORM name="frm" method="post">
<%
//try {
request.getSession();
ser.comum.Traducao.Traducao trd  = (ser.comum.Traducao.Traducao)session.getAttribute("Traducao");
ser.comum.conexao.Conexao conexao  = (ser.comum.conexao.Conexao)session.getAttribute("Conexao");
ser.comum.param.param prm  = (ser.comum.param.param)session.getAttribute("Param");


Integer usu_fil 	= (Integer)session.getAttribute("usu_fil"); 
Integer usu_idi 	= (Integer)session.getAttribute("usu_idi"); 
Integer usu_codigo 	= (Integer)session.getAttribute("usu_cod");
String usu_tipo		= (String) session.getAttribute("usu_tipo"); 
String usu_nome		= (String) session.getAttribute("usu_nome"); 
String usu_login	= (String) session.getAttribute("usu_login"); 
String usu_plano 	= ""; 
usu_plano = usu_plano.valueOf(session.getAttribute("usu_plano")); 

int pag = (((String)session.getAttribute("pagina")==null)?7:Integer.parseInt((String)session.getAttribute("pagina")));

ResultSet rs = null, rse = null;

//recupera os dados da pagina
String pag_assunto 	= (request.getParameter("selectass")==null)?"":(String)request.getParameter("selectass");
String pag_titulo 	= (request.getParameter("selecttit")==null)?"":(String)request.getParameter("selecttit");
String pag_curso 	= (request.getParameter("selectcur")==null)?"":(String)request.getParameter("selectcur");
String pag_dtini 	= (request.getParameter("txtdtinic")==null)?"":(String)request.getParameter("txtdtinic");
String pag_dtfim 	= (request.getParameter("txtdtfim")==null)?"":(String)request.getParameter("txtdtfim");
String pag_cuscur	= (request.getParameter("txtcustocurso")==null)?"":(String)request.getParameter("txtcustocurso");
String pag_cuslog 	= (request.getParameter("txtcustolog")==null)?"0":(String)request.getParameter("txtcustolog");
String pag_duracao 	= (request.getParameter("txtduracao")==null)?"":(String)request.getParameter("txtduracao");
String pag_duracao2 = (request.getParameter("txtduracao2")==null)?"":(String)request.getParameter("txtduracao2");
String pag_entidade = (request.getParameter("selectent")==null)?"":(String)request.getParameter("selectent");
String pag_instrutor= (request.getParameter("selectinst")==null)?"":(String)request.getParameter("selectinst");
String pag_obs 		= (request.getParameter("txtobs")==null)?"":(String)request.getParameter("txtobs");

//declaracao das variaveis
String	query = ""	, descricao = "", custo = ""	, teste = ""	, dtini_p = "", aux = "", 
		dtfim_p = "", avaliacao = "", query_cur = "", query_tit = "", query_ass = "";

java.util.Date dataAtual = new java.util.Date();
SimpleDateFormat formato = new SimpleDateFormat("dd/MM/yyyy");
String dia = formato.format(dataAtual);
Calendar cal_env = Calendar.getInstance();
Calendar cal_ven = Calendar.getInstance();
Vector vet_desc = new Vector();
Vector vet_cust = new Vector();
int cont=0;
boolean contem=false;
float cur_custo = 0;


String moeda = prm.buscaparam("MOEDA");

%> <!--******INICIO SCRIPLETS******--> <%!public String CalendarToString(Calendar cal) {
		String dia = "", mes = "", ano = "";
		if (cal.get(Calendar.DAY_OF_MONTH) < 10)
			dia = "0" + cal.get(Calendar.DAY_OF_MONTH);
		else
			dia = "" + cal.get(Calendar.DAY_OF_MONTH);
		if ((cal.get(Calendar.MONTH) + 1) < 10)
			mes = "0" + (cal.get(Calendar.MONTH) + 1);
		else
			mes = "" + cal.get(Calendar.MONTH);
		ano = "" + cal.get(Calendar.YEAR);

		return (dia + "/" + mes + "/" + ano);
	}%> <%!public String replaceString(String s, String busca, String troca) {
		String nova = "";
		int ini = s.indexOf(busca);
		boolean ok = false;
		if (ini > 0) {
			ok = true;
		} else {
			nova = s;
		}
		while (ok) {
			int fim = busca.length();
			nova = s.substring(0, ini) + troca
					+ s.substring(ini + fim, s.length());
			ini = nova.indexOf(busca);
			if (ini > 0) {
				s = nova;
			} else {
				ok = false;
			}
		}
		return nova;
	}%> <%!public String durhora(float valor) {
		int ho = 0;
		Float h;
		h = new Float(valor);
		;
		ho = h.intValue();
		ho = ho / 60;
		String hora = "";
		hora = hora.valueOf(ho);
		return hora;
	}%> <%!public String durmin(float valor) {
		int mi = 0;
		Float m;
		m = new Float(valor);
		mi = m.intValue();
		mi = mi % 60;
		String min = "";
		if (mi < 10) {
			min = "0" + min.valueOf(mi);
		} else {
			min = min.valueOf(mi);
		}
		return min;
	}%> <%!public String ReaistoStr(float valor) {
		DecimalFormat dcf = new DecimalFormat("0.00");
		dcf.setMaximumFractionDigits(2);
		String strReais = dcf.format(valor);
		return strReais;
	}%> <%!public String ReaistoStr2(float valor, String moeda) {
		DecimalFormat dcf = new DecimalFormat("0.00");
		dcf.setMaximumFractionDigits(2);
		String strReais = dcf.format(valor);
		return moeda + strReais;
	}%> <!--******FIM SCRIPLETS******--> <%
if(vet_desc.size()!=0) vet_desc.clear();
if(vet_cust.size()!=0) vet_cust.clear();

//limpa os vetores de custo
if (request.getParameter("limpa_vets") == null) {
    //out.println("LIMPOU");
    session.setAttribute("vet_descS",vet_desc);
    session.setAttribute("vet_custS",vet_cust);
}

//recupera da sessao os vetores de custo
if((Vector)session.getAttribute("vet_descS") != null)
    vet_desc = (Vector)session.getAttribute("vet_descS");
if((Vector)session.getAttribute("vet_custS") != null)
    vet_cust = (Vector)session.getAttribute("vet_custS");

//detela itens dos vetores de custo
String deleta = (request.getParameter("deleta_vets")==null)?"":(String)request.getParameter("deleta_vets");
if (deleta.equals("S")) {
    int t = vet_cust.size();
    for(int i=t;i>=0;i--) {
        if(request.getParameter("vet"+i) != null) {
            aux = request.getParameter("vet"+i);
            int novo = Integer.parseInt((String)aux);
            vet_desc.remove(novo);
            vet_cust.remove(novo);
            //out.println("EXCLUIU, i"+i+",t"+t);
        }
    }
}

//adiciona itens aso vetores de custo
String desc_logistica = (request.getParameter("txt_desc")==null)?"":(String)request.getParameter("txt_desc");
if(!desc_logistica.equals("")) {
    //out.println("ADICIONOU!!!");
    if(!(vet_desc.contains(request.getParameter("txt_desc")))) {
        vet_desc.addElement(request.getParameter("txt_desc"));
	if(request.getParameter("txt_cust") != null) {
            String xis = request.getParameter("txt_cust");
            //xis = replaceString(xis,"R$","");
            xis = replaceString(xis,".","");
            xis = replaceString(xis,",",".");
            vet_cust.addElement(xis);
	}
    }
}

request.getSession(true);
session.setAttribute("vet_descS",vet_desc);
session.setAttribute("vet_custS",vet_cust);

float total = 0;
if(request.getParameter("total2") != null) {
    String m = request.getParameter("total2");
    total = Float.parseFloat(m);
}

String origem = "";
if(request.getParameter("origem") != null)
    origem = request.getParameter("origem");

//verifica dadas limite do plano
query = "SELECT PLA_DATAINICIO, PLA_DATAFINAL FROM PLANO WHERE PLA_CODIGO = " +usu_plano;
rs = conexao.executaConsulta(query,session.getId());
if (rs.next()) {
  dtini_p = formato.format(rs.getDate(1)); //out.println(dtini_p);
  dtfim_p = formato.format(rs.getDate(2)); //out.println(dtfim_p);
  rs = null;
}
if(rs!=null){
    rs.close();
    conexao.finalizaConexao(session.getId());
}

//Prepara o vetor de Treinamentos Planejados
String n = "";
Vector funcvet = new Vector();
if ((Vector)session.getAttribute("vec_plan") != null)
  funcvet = (Vector)session.getAttribute("vec_plan");
else
  funcvet.setSize(0);


//Verifica se foram escolhidos Treinamentos Planejados
boolean existeTP = true;
if (funcvet.isEmpty())
    existeTP = false;

//Verifica se foram adicionados Treinamentos nao Planejados
boolean existeTNP = true;
String query_verif = "";
if ((Vector)session.getAttribute("vec_nplan") != null)
	existeTNP = true;
else
	existeTNP = false;

//Verifica se os Treinamentos Planejados escolhidos sao do mesmo CURSO
boolean dif_curso = false;
int curso = 0;
if (existeTP) {

  String[] strpa = (String[])funcvet.elementAt(0);

  query_verif = "SELECT C.CUR_CODIGO FROM CURSO C, TREINAMENTO T WHERE " +
                "T.CUR_CODIGO = C.CUR_CODIGO AND T.TEF_CODIGO = " + strpa[0];
  rs = conexao.executaConsulta(query_verif,session.getId());
  //out.println(query_verif);
  if (rs.next()) 
   curso = rs.getInt(1);
   if(rs!=null){
    rs.close();
    conexao.finalizaConexao(session.getId());
    }
  for(int i=0; i<funcvet.size(); i++) {
    String[] strp = (String[])funcvet.elementAt(i);
    query_verif = "SELECT C.CUR_CODIGO FROM CURSO C, TREINAMENTO T WHERE " +
                  "T.CUR_CODIGO = C.CUR_CODIGO AND T.TEF_CODIGO = " + strp[0];
    rs = conexao.executaConsulta(query_verif,session.getId());
    if (rs.next()) {
      //out.println("RS: " + rs.getInt(1) + "Curso: " + curso);
      if (rs.getInt(1) != curso)
        dif_curso = true;
    }
    if(rs!=null){
        rs.close();
        conexao.finalizaConexao(session.getId());
        }
  }
}
if (dif_curso) {%> <script language="JavaScript">
      alert(<%=("\""+trd.Traduz("Favor escolher funcionarios do mesmo curso!")+"\"")%>);
      history.go(-1);
    </script> <%
    funcvet.clear();
} else {
  //colcoa na secao o vetor de funcionarios
}
session.setAttribute("funcs",funcvet);

//se alterou a combo
if ((!(pag_curso.equals(""))) && (!(pag_curso.equals("Selecione"))))
{
  if (request.getParameter("selectcur") != null)
    curso = Integer.parseInt((String)request.getParameter("selectcur"));
}

//Busca valores para os combos
if (pag_assunto.equals("")) {
    query = "SELECT C.CUR_CODIGO, T.TIT_CODIGO, A.ASS_CODIGO " +
            "FROM CURSO C, TITULO T, ASSUNTO A " +
            "WHERE C.CUR_CODIGO = " + curso + " " + 
            "AND C.TIT_CODIGO = T.TIT_CODIGO " +
            "AND T.ASS_CODIGO = A.ASS_CODIGO";
    rs = conexao.executaConsulta(query,session.getId()+"RS");
    if (rs.next()) {
        pag_curso = rs.getString(1);
        pag_titulo = rs.getString(2);
        pag_assunto = rs.getString(3);
    }
    if(rs!=null){
    rs.close();
    conexao.finalizaConexao(session.getId()+"RS");
    }
}
%> <script language="JavaScript">


function enviar() {
    var c = frm.cont_avaliacao.value; //aux. loop de verificacao das datas de envio e vencimento
    for(i=1;i<=c;i++) {
      if(eval("frm.chk_"+i+".checked") && ((eval("frm.txt_dt_vencimento_"+i+".value")=="") || (eval("frm.txt_dt_envio_"+i+".value")==""))) {
        alert(<%=("\""+trd.Traduz("Favor escolher data de envio e data de vencimento para as avaliacoes escolhidas!")+"\"")%>);
        return false;
      } else {
        if(eval("frm.chk_"+i+".checked") && (eval("frm.cbo_questionario_"+i+".value")=="")) {
          alert(<%=("\""+trd.Traduz("Favor escolher um questionArio para a avaliacao escolhida!")+"\"")%>);
          return false;
        }
      }
    }

    var data1 = document.frm.txtdtinic.value; //data inicial da tela
    var data2 = document.frm.txtdtfim.value; //data final da tela
    var data3 = "<%=dtini_p%>"; //data inicial do plano
    var data4 = "<%=dtfim_p%>"; //data final do plano
    i1=0; i2=0; i3=0; i4=0;
    while(i1<data1.length){
        i1++;
    }
    while(i2<data2.length){
	i2++;
    }
    while(i3<data3.length){
	i3++;
    }
    while(i4<data4.length){
	i4++;
    }
    if(data1.length==9)
	data1 ="0"+data1;
    if(data2.length==9)
	data2 ="0"+data2;
    if(data3.length==9)
	data3 ="0"+data3;
    if(data4.length==9)
	data4 ="0"+data4;

    var dia1 = data1.substring(0,2);
    var dia2 = data2.substring(0,2);
    var dia3 = data3.substring(0,2);
    var dia4 = data4.substring(0,2);
    var mes1 = data1.substring(3,5);
    var mes2 = data2.substring(3,5);
    var mes3 = data3.substring(3,5);
    var mes4 = data4.substring(3,5);
    var ano1 = data1.substring(6,10);
    var ano2 = data2.substring(6,10);
    var ano3 = data3.substring(6,10);
    var ano4 = data4.substring(6,10);    

    if (frm.selectass.value == "") {
        alert(<%=("\""+trd.Traduz("Favor escolher o assunto!")+"\"")%>);
        frm.selectass.focus();
    }
    else
    {
        if (frm.selecttit.value == "") {
            alert(<%=("\""+trd.Traduz("Favor escolher o titulo!")+"\"")%>);
            frm.selecttit.focus();
	}
	else
	{
            if (frm.selectcur.value == "") {
                alert(<%=("\""+trd.Traduz("Favor escolher o curso!")+"\"")%>);
                frm.selectcur.focus();
            }
            else
	    {
                if (frm.txtdtinic.value == "") {
                    alert(<%=("\""+trd.Traduz("Favor digitar data inicial!")+"\"")%>);
                    frm.txtdtinic.focus();
		}
		else
                {
                    if (frm.txtdtfim.value == "") {
                        alert(<%=("\""+trd.Traduz("Favor digitar data final!")+"\"")%>); 
                        frm.txtdtfim.focus();
                    }
                    else
                    {
                        if (frm.txtcustocurso.value == "") {
                            alert(<%=("\""+trd.Traduz("Favor digitar custo do curso!")+"\"")%>); 
                            frm.txtcustocurso.focus();
			 }
			 else
			 {
                            if (frm.txtcustolog.value == "") {
                                alert(<%=("\""+trd.Traduz("Favor digitar custo de logistica!")+"\"")%>); 
                                frm.txtcustolog.focus();
                            }
                            else
                            {
                                if (frm.txtduracao.value == "" || frm.txtduracao2.value == "") {
                                    alert(<%=("\""+trd.Traduz("Favor digitar duracao do curso (hh:mm)!")+"\"")%>); 
                                    frm.txtduracao.focus();
				}
				else
				{					
                                    if (frm.selectent.value == "") {
                                        alert(<%=("\""+trd.Traduz("Favor escolher a entidade")+"\"")%>); 
                                        frm.selectent.focus();
                                    }
									else
                                        {
                                            if(ano1>ano2){
                                                alert(<%=("\""+trd.Traduz("A data final nAo pode ser menor que a data de inicial")+"\"")%>);
                                                document.frm.txtdtfim.value="";
                                                document.frm.txtdtfim.focus();
                                                return false;	
                                            }
                                            else if(ano1==ano2){
                                                if (mes1>mes2){
                                                    alert(<%=("\""+trd.Traduz("A data final nAo pode ser menor que a data de inicial")+"\"")%>);
                                                    document.frm.txtdtfim.value="";
                                                    document.frm.txtdtfim.focus();
                                                    return false;	
                                                }
                                                else if(mes1==mes2){
                                                    if(dia1>dia2){	
                                                        alert(<%=("\""+trd.Traduz("A data final nAo pode ser menor que a data de inicial")+"\"")%>);
                                                        document.frm.txtdtfim.value="";
                                                        document.frm.txtdtfim.focus();
                                                        return false;	
                                                    }
                                                }
                                                if(ano1<ano3 || ano1>ano4){
                                                        alert(<%=("\""+trd.Traduz("A data inicial estA fora do perIodo do plano")+"\""%> + ("+data3+ " - " +data4+")+" ! ");
                                                        document.frm.txtdtinic.value="";
                                                        document.frm.txtdtinic.focus();
                                                        return false;	
                                                    }
                                                    else if(ano1==ano3){
                                                        if (mes1<mes3 || mes1>mes4){
                                                            alert(<%=("\""+trd.Traduz("A data inicial estA fora do perIodo do plano")%> ("+data3+ " - " +data4+")+" !");
                                                            document.frm.txtdtinic.value="";
                                                            document.frm.txtdtinic.focus();
                                                            return false;	
                                                        }
                                                        else if((dia1<dia3 || dia1>dia4) && (mes1==mes3 || mes1==mes4)){	
                                                                alert(<%=("\""+trd.Traduz("A data inicial estA fora do perIodo do plano")%> ("+data3+ " - " +data4+")+"!");
                                                                document.frm.txtdtinic.value="";
                                                                document.frm.txtdtinic.focus();
                                                                return false;
                                                            };
                                                    }
                                            }
                                            frm.action = "03_registrarlistadepresenca_grava.jsp";
                                            frm.submit();
                                            return false; 
                                        }
                                    }
								}
	                        }
		                }
			        }
	            }
		    }
	    }
	}







function numero(campo){
	aux = campo.value;
	tam = aux.length
	aux2 = aux.substring(tam-1,tam);
	if(aux2 != "0" && aux2 != "1" && aux2 != "2" && aux2 != "3" && aux2 != "4" && aux2 != "," &&
	   aux2 != "5" && aux2 != "6" && aux2 != "7" && aux2 != "8" && aux2 != "9"){
		aux = campo.value;
		aux = aux.length;
		aux = aux - 1;
		pal = campo.value;
		campo.value = pal.substring(0, aux);
	}
}

function numero2(){
	aux = frm.txtcustocurso.value;
	tam = aux.length;
	k = 0;
	v = 0;
	if(tam == 1){
		aux2 = aux.substring(tam-1,tam);
		if(aux2 == ","){
			frm.txtcustocurso.value = "";
		}
	}
	while(tam>0){
		aux2 = aux.substring(tam-1,tam);
		if(aux2 != "0" && aux2 != "1" && aux2 != "2" && aux2 != "3" && aux2 != "4" && aux2 != "," &&
		   aux2 != "5" && aux2 != "6" && aux2 != "7" && aux2 != "8" && aux2 != "9"){
			k = k+1;
		}
		if(aux2 == ","){
			v = v+1;
		}
		tam--;
	}
	if(k != 0 || v > 1){
		alert(<%=("\""+trd.Traduz("FORMATO INVALIDO")+"\"")%>);
		frm.txtcustocurso.value = "";
		frm.txtcustocurso.focus();
	}
	atualiza();
}

function numero3(campo){
	aux = campo.value;
	tam = aux.length;
	k = 0;
	v = 0;
	if(tam == 1){
		aux2 = aux.substring(tam-1,tam);
		if(aux2 == ","){
			campo.value = "";
		}
	}
	while(tam>0){
		aux2 = aux.substring(tam-1,tam);
		if(aux2 != "0" && aux2 != "1" && aux2 != "2" && aux2 != "3" && aux2 != "4" && aux2 != "," &&
		   aux2 != "5" && aux2 != "6" && aux2 != "7" && aux2 != "8" && aux2 != "9"){
			k = k+1;
		}
		if(aux2 == ","){
			v = v+1;
		}
		tam--;
	}
	if(k != 0 || v > 1){
		alert(<%=("\""+trd.Traduz("FORMATO INVALIDO")+"\"")%>);
		campo.value = "";
		campo.focus();
	}
}

function FormataCampo(campo, evento, direcao){
    //alert(evento);
    aux = campo.value;
    aux = aux.length;
    aux = aux - 1;
    pal = campo.value;
	if (campo.value.length < 1000000){
		if(evento != 9 ){//tab
			if(evento != 8 && evento != 46 && evento != 16 && !(evento > 36 && evento < 41) && evento!=190 && evento!=110 && evento!=194){ //delete, backspace, shift nAo causam evento
				var tam = campo.value.length;
				if ((evento >= 48 && evento <= 57) || (evento >= 96 && evento <= 105)){
					if (tam == 2 || tam == 5){
						campo.value = campo.value + "";
					}
				}
				else{
					if (direcao == "up"){
						if (campo.value.length == 0){
                                                        //campo.value = pal.substring(0, aux);
							campo.value = "";
						}
						else{
                                                        //campo.value = pal.substring(0, aux);
							campo.value = "";//campo.value.substring(0,campo.value.length-1)
						}
					}
				}
				campo.focus();
			}
			else if(evento == 16){
                                //campo.value = pal.substring(0, aux);
				campo.value="";
			}

		} 
		else{
			if (direcao == "down"){
				var teste = campo.value.substring(0,1);
				if(campo.value<0){
					alert(<%=("\""+trd.Traduz("Este campo nAo aceita valores negativos !")+"\"")%>);
                                        //campo.value = pal.substring(0, aux);
					campo.value="";
					campo.focus();
					return false;
				}
				else if(teste=="-"||teste=="+"||teste=="~"||teste=="^"||
					teste=="\""||teste=="'"||teste=="!"||teste=="@"||
					teste=="#"||teste=="$"||teste=="%"||teste=="¨"||
					teste=="&"||teste=="*"||teste=="("||teste==")"||
					teste=="_"||teste=="="||teste=="~"||teste=="`"||
					teste=="´"||teste=="{"||teste=="["||teste=="}"||
					teste=="]"||teste=="<"||
					teste==">"||teste==":"||teste==";"||teste=="/"||
					teste=="?"||teste=="|"||teste=="\\"||teste=="^"){
					alert(<%=("\""+trd.Traduz("Este campo nAo aceita caracteres especiais !")+"\"")%>);
                                        //campo.value = pal.substring(0, aux);
					campo.value="";
					campo.focus();
					return false;
				}
			}
		}
	}
	//formataReal(campo);
}

function FormataData(campo, evento, direcao){
	if (campo.value.length < 10000){
		if (evento != 9 ){//tab
			if(evento != 8 && evento != 46 && evento != 16 && !(evento > 36 && evento < 41)){ //delete, backspace, shift nAo causam evento
				var tam = campo.value.length
				if ((evento >= 48 && evento <= 57) || (evento >= 96 && evento <= 105)) {
					if (tam == 2 || tam == 5){
						campo.value = campo.value + "/";
						}
					} 
				else{
					if (direcao == "up"){
						if (campo.value.length == 0){
							campo.value = ""
							}
						else{
							campo.value = campo.value.substring(0,campo.value.length-1)
							}
						}
					}
				campo.focus()
				}
			} 
		else{
			if (direcao == "down"){
				ChecaData(campo)
				}
			}
		}
	}
	
function ChecaData(THISDATE){
        //alert ("T");
	var erro = 0;
	var data = THISDATE.value;
	if (data.length != 10) 
		erro=1;
	var dia = data.substring(0, 2);// dia
	var barra1 = data.substring(2, 3);// '/'
	var mes = data.substring(3, 5);// mes
	var barra2 = data.substring(5, 6);// '/'
	var ano = data.substring(6, 10);// ano
		
	if (mes < 1 || mes > 12) 
		erro = 1;
	if (dia < 1 || dia > 31) 
		erro = 1;
	if (ano < 1990) 
		erro = 1;
	if (mes == 4 || mes == 6 || mes == 9 || mes == 11){
		if (dia == 31) 
			erro = 1;
			}
	if (mes == 2){
		var bis = parseInt(ano/4);
		if (isNaN(bis)){
			erro = 1;
			}
		if (dia > 29) 
			erro = 1;
		if (dia == 29 && ((ano/4) != parseInt(ano/4))) 
			erro = 1;
		}
	if ((erro == 1) && (THISDATE.value != "")) {
		alert(THISDATE.value + ' <%=trd.Traduz("E uma data invAlida!")%>');
		THISDATE.value = "";
		}
	}

function DoCal(elTarget){
	if (showModalDialog){
		var sRtn;
		sRtn = showModalDialog("calendar.htm","","center=yes;status=no;dialogWidth=306px;dialogHeight=220px");
		if (sRtn!="")
			elTarget.value = sRtn;
		} 
	else{

		var msg  =<%=("\""+trd.Traduz("INTERNET EXPLORER 4.0 OU SUPERIOR E NECESSARIO")+"\"")%>+ "";
		alert(msg);
	}
}

function insere() {
    if(frm.txt_desc.value == ""){
        var msg =<%=("\""+trd.Traduz("DIGITE A DESCRICAO")+"\"")%> + "";  
        alert(msg);
		frm.txt_desc.focus();
		return false;
    }
    else if(frm.txt_cust.value == "")
    {
        var msg  = <%=("\""+trd.Traduz("DIGITE O CUSTO")+"\"")%> +""; 
		alert(msg);
		frm.txt_cust.focus();
		return false;
    }
    else
    {
	frm.action("02_registrarlistadepresenca.jsp");
	frm.submit();
	return true;
    }

}

function deleta() {
    var cont=0;
    for(i=0;i<frm.contador.value;i++)
    {
        if(eval("frm.vet"+i+".checked")==true)
	{
            cont = cont + 1;
	}
    }
    if(cont==0)
    {
        alert(<%=("\""+trd.Traduz("NENHUM ITEM SELECIONADO")+"\"")%>);
	return false;
    }
    else
    {
        if(confirm(<%=("\""+trd.Traduz("DESEJA EXCLUIR O ITEM SELECIONADO?")+"\"")%>))
        {
            frm.deleta_vets.value="S";
            frm.action="02_registrarlistadepresenca.jsp";
            frm.submit();
            return true;
        }
        else
            return false;
    }
}

function assunto() { 
    if (frm.selectass.value != "") {
	frm.selecttit.value = null;
	frm.selectcur.value = null;
	frm.action ="02_registrarlistadepresenca.jsp";
	frm.submit();
    }
    return false;	
}

function titulo() {
    if (frm.selecttit.value != "") {
	frm.selectcur.value = null;
	frm.action ="02_registrarlistadepresenca.jsp";
	frm.submit();
    }
    return false;	
}

function curso() {
    if (frm.selectcur.value != "") {
	frm.action ="02_registrarlistadepresenca.jsp";
	frm.submit();
    }
    return false;	
}

function aspa(campo){
	aux = campo.value;
	tam = aux.length
	aux2 = aux.substring(tam-1,tam);
	if(aux2 == "\"" || aux2 == "\'"){
		aux = campo.value;
		aux = aux.length;
		aux = aux - 1;
		pal = campo.value;
		campo.value = pal.substring(0, aux);
	}
}

function aspa2(campo){
	aux = campo.value;
	tam = aux.length;
	i = 0;
	nova = "";
	while(i != tam){
		aux2 = aux.substring(i,i+1);
		if(aux2 == "\"" || aux2 == "\'")
			nova = nova;
		else
			nova = nova + aux2;
		i++;
		
	}
	campo.value = nova;
}

</script> <script type="text/javascript" src="register.js"></script>
<table width="100%" border="0" cellspacing="0" cellpadding="0"
	height="100%">
	<tr>
		<td valign="top">
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td height="59" class="hcfundo">
				<table width="100%" border="0" cellspacing="0" cellpadding="0">
					<tr>
						<%	      String ponto = (String)session.getAttribute("barra");
	      if(ponto.equals("..")){%>
						<jsp:include page="../menu/banner.jsp" flush="true"><jsp:param
								value="opt" name="RG" /></jsp:include>
						<%}else{%>
						<jsp:include page="/menu/banner.jsp" flush="true"><jsp:param
								value="opt" name="RG" /></jsp:include>
						<%}%>
					</tr>
				</table>
				</td>
			</tr>
			<tr>
				<td class="mnfundo"><img src="../art/bit.gif" width="12"
					height="5"></td>
			</tr>
			<tr>
				<td height="25" class="mnfundo">
				<table border="0" cellspacing="0" cellpadding="0">
					<tr>
						<%String oi = "", oia = "";
                 if(ponto.equals("..")){
				if (request.getParameter("op") == null)
				{
                  oi = "../menu/menu.jsp?op="+"R";
				}
				else
				{
                  oi = "../menu/menu.jsp?op="+request.getParameter("op");
				}
				if (request.getParameter("opt") == null)
				{
                  oia = "../menu/menu1.jsp?opt="+"RL";
				} 
				else
				{  
                  oia = "../menu/menu1.jsp?opt="+request.getParameter("opt");
				}
		}else{
			if (request.getParameter("op") == null)
			{
				oi = "/menu/menu.jsp?op="+"R";
			}
			else
			{
		        	oi = "/menu/menu.jsp?op="+request.getParameter("op");
			}
			if (request.getParameter("opt") == null)
			{
		        	oia = "/menu/menu1.jsp?opt="+"RL";
			} 
			else
			{  
		        	oia = "/menu/menu1.jsp?opt="+request.getParameter("opt");
			}
		}%>
						<jsp:include page="<%=oi%>" flush="true"></jsp:include>
					</tr>
				</table>
				</td>
			</tr>
			<jsp:include page="<%=oia%>" flush="true"></jsp:include>
		</table>
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td width="20">&nbsp;</td>
				<td width="100%" align="center">
				<table border="0" cellspacing="0" cellpadding="0">
					<tr>
						<td width="13"><img src="../art/bit.gif" width="13"
							height="15"></td>
						<td class="trontrk" align="center"><%=trd.Traduz("Registrar Lista de PresenCa")%></td>
						<td width="29"><img src="../art/bit.gif" width="13"
							height="15"></td>
					</tr>
				</table>
				</td>
				<td width="20">&nbsp;</td>
			</tr>
			<tr>
				<td width="20" height="1"><img src="../art/bit.gif" width="1"
					height="1"></td>
				<td valign="top" class="ctvdiv"><img src="../art/bit.gif"
					width="1" height="1"></td>
				<td width="20"><img src="../art/bit.gif" width="1" height="1"></td>
			</tr>
			<tr>
				<td width="20" valign="top"></td>

				<td valign="top"><img src="../art/bit.gif" width="159"
					height="1">&nbsp;<br>
				<center>
				<table border="0" cellspacing="0" cellpadding="0" width="85%">
					<tr>
						<td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Assunto")%>:</td>
						<td class="ftverdanacinza" colspan="6"><select
							name="selectass" onChange="return assunto();">
							<%                      query = "SELECT ASS_CODIGO, ASS_NOME FROM ASSUNTO " +
                                "WHERE ASS_ATIVO = 'S' ORDER BY ASS_NOME";

                           if ((!(pag_curso.equals(""))) && (!(pag_curso.equals("Selecione"))))
						   {
                            query_tit = "SELECT ASS_CODIGO FROM TITULO " + 
                               "WHERE TIT_CODIGO IN (SELECT TIT_CODIGO FROM CURSO WHERE CUR_CODIGO = " + pag_curso + ") ";
                               

                              rs = conexao.executaConsulta(query_tit,session.getId()+"RS_2"); 
                              if (rs.next()) {
                                    pag_assunto = rs.getString(1);   
                                }
                              if(rs!=null){
                                rs.close();
                                conexao.finalizaConexao(session.getId()+"RS_2");
                                }  
                            }
                            if ((!(pag_titulo.equals(""))) && (!(pag_titulo.equals("Selecione")))){
                                    query_ass = "SELECT ASS_CODIGO FROM TITULO " + 
                                        "WHERE TIT_CODIGO = " + pag_titulo + " ";
                                    rs = conexao.executaConsulta(query_ass,session.getId()+"RS_3"); 
                                    if (rs.next()){
                                        pag_assunto = rs.getString(1);
					}
                                    if (rs!=null){
                                        rs.close();
                                        conexao.finalizaConexao(session.getId()+"RS_3");
                                        }
                            }

                        rs = conexao.executaConsulta(query,session.getId()+"RS_4");
                        if (rs.next()){%>
							<option value="Selecione" selected><%=trd.Traduz("Selecione")%></option>
							<%                      do {
                           if (pag_assunto.equals(rs.getString(1))) {%>
							<option value="<%=rs.getInt(1)%>" selected><%=rs.getString(2)%></option>
							<%                         } else {%>
							<option value="<%=rs.getInt(1)%>"><%=rs.getString(2)%></option>
							<%                         }
                        } while (rs.next());
		        }
                        if(rs!=null){
                            rs.close();
                            conexao.finalizaConexao(session.getId()+"RS_4");
                            }
%>
						</select></td>
					</tr>
					<tr>
						<td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Titulo")%>:</td>
						<td class="ftverdanacinza" colspan="6"><select
							name="selecttit" onChange="return titulo();">
							<option value="Selecione" selected><%=trd.Traduz("Selecione")%></option>
							<%
                        if ((!(pag_assunto.equals(""))) && (!(pag_assunto.equals("Selecione")))){
                            query = "SELECT TIT_CODIGO, TIT_NOME FROM TITULO " + 
                            "WHERE TIT_ATIVO = 'S' AND ASS_CODIGO = " + pag_assunto + " " + 
                            "ORDER BY TIT_NOME";					   
                        }
                        else{
                            query = "SELECT TIT_CODIGO, TIT_NOME FROM TITULO " + 
                            "WHERE TIT_ATIVO = 'S' ORDER BY TIT_NOME";						
                        }
                        if ((!(pag_curso.equals(""))) && (!(pag_curso.equals("Selecione")))){
                            query_cur = "SELECT TIT_CODIGO FROM CURSO " + 
                            "WHERE CUR_CODIGO = " + pag_curso + " ";
                        rs = conexao.executaConsulta(query_cur,session.getId()+"RS_4");
                                if (rs.next()){
                                  pag_titulo = rs.getString(1);
                                }
                                if(rs!=null){
                                    rs.close();
                                    conexao.finalizaConexao(session.getId()+"RS_4");
                                }
                        }
                        rs = conexao.executaConsulta(query,session.getId()+"RS_5");
                            if (rs.next()) {
                                do { 
                                    if (pag_titulo.equals(rs.getString(1))) {%>
							<option value="<%=rs.getInt(1)%>" selected><%=rs.getString(2)%></option>
							<%                                  } else {%>
							<option value="<%=rs.getInt(1)%>"><%=rs.getString(2)%></option>
							<%                                  }
                                } while (rs.next());
                            }
                            if(rs!=null){
                                rs.close();
                                conexao.finalizaConexao(session.getId()+"RS_5");
                            }
                        %>
						</select></td>
					</tr>
					<tr>
						<td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Curso")%>:</td>
						<td class="ftverdanacinza" colspan="6"><select
							name="selectcur" onChange="return curso();">
							<option value="Selecione" selected><%=trd.Traduz("Selecione")%></option>
							<%                      /*if (!pag_titulo.equals("")) {
                            query = "SELECT CUR_CODIGO, CUR_NOME FROM CURSO WHERE CUR_ATIVO = 'S' AND CUR_SIMPLES = 'N' " +
                                    "AND TIT_CODIGO = " +pag_titulo+ " " +
                                    "ORDER BY CUR_NOME";*/

                       if ((!(pag_titulo.equals(""))) && (!(pag_titulo.equals("Selecione")))){
                       query = "SELECT CUR_CODIGO, CUR_NOME FROM CURSO " +
                               "WHERE CUR_ATIVO = 'S' AND TIT_CODIGO = " + pag_titulo + " " + 
                               " AND CUR_SIMPLES = 'N' ORDER BY CUR_NOME, CUR_CODIGO";
			           }
			           else
					   {

						   if ((!(pag_assunto.equals(""))) && (!(pag_assunto.equals("Selecione"))))
						   {
                           query = "SELECT CUR_CODIGO, CUR_NOME FROM CURSO " + 
                               "WHERE CUR_ATIVO = 'S' AND CUR_SIMPLES = 'N' AND TIT_CODIGO IN (SELECT TIT_CODIGO FROM TITULO WHERE ASS_CODIGO = " + pag_assunto + ") " + 
                               "ORDER BY CUR_NOME";
						   }
						   else
						   {
	
                               query = "SELECT CUR_CODIGO, CUR_NOME FROM CURSO " +
                               "WHERE CUR_ATIVO = 'S' AND CUR_SIMPLES = 'N' ORDER BY CUR_NOME";
						   }
					   }

                            rs = conexao.executaConsulta(query,session.getId());
                            if (rs.next()) {
                                //if (pag_curso.equals("")) pag_curso = rs.getString(1);
                                do { 
                                    if (pag_curso.equals(rs.getString(1))) {%>
							<option value="<%=rs.getInt(1)%>" selected><%=rs.getString(2)%></option>
							<%                                  } else {%>
							<option value="<%=rs.getInt(1)%>"><%=rs.getString(2)%></option>
							<%                                  }
                                }
                                while (rs.next());
                            }
                            if(rs!=null){
                               rs.close();
                               conexao.finalizaConexao(session.getId());
                            }
                        /*}*/%>
						</select></td>
					</tr>
					<tr>
						<td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Data Inicial")%>:</td>
						<td class="ftverdanacinza">
						<%                    if (pag_dtini.equals("")){%> <input
							type="text" name="txtdtinic" size="9" value="<%=dia%>"
							onChange="ChecaData(this)"
							onKeyDown="FormataData(this, window.event.keyCode,'down')"
							onKeyUp="FormataData(this, window.event.keyCode,'up')"> <%                    } else {%>
						<input type="text" name="txtdtinic" size="9"
							value="<%=pag_dtini%>" onChange="ChecaData(this)"
							onKeyDown="FormataData(this, window.event.keyCode,'down')"
							onKeyUp="FormataData(this, window.event.keyCode,'up')"> <%                    }%>
						&nbsp;<img onclick="DoCal(txtdtinic)" style="cursor: hand"
							src="../art/icon_cal.gif" title="CalendArio" WIDTH="17"
							HEIGHT="16"></td>
						<td class="ftverdanacinza" nowrap align="right"><%=trd.Traduz("Data Final")%>:</td>
						<td class="ftverdanacinza" colspan="4">
						<%                    if (pag_dtfim.equals("")){%> <input
							type="text" name="txtdtfim" size="9" value="<%=dia%>"
							onChange="ChecaData(this)"
							onKeyDown="FormataData(this, window.event.keyCode,'down')"
							onKeyUp="FormataData(this, window.event.keyCode,'up')"> <%                    } else {%>
						<input type="text" name="txtdtfim" size="9" value="<%=pag_dtfim%>"
							onChange="ChecaData(this)"
							onKeyDown="FormataData(this, window.event.keyCode,'down')"
							onKeyUp="FormataData(this, window.event.keyCode,'up')"> <%                    }%>
						&nbsp;<img onclick="DoCal(txtdtfim)" style="cursor: hand"
							src="../art/icon_cal.gif" title="CalendArio" WIDTH="17"
							HEIGHT="16"></td>
					</tr>
					<tr>
						<td class="ftverdanacinza" align="right"><%=trd.Traduz("CUSTO CURSO")%>:
						<%=moeda%></td>
						<td class="ftverdanacinza" colspan="2" nowrap>
						<%                  
					
					if(pag_cuscur.equals("")){
						query = "SELECT CUR_CUSTO, CUR_CUSTO2 FROM CURSO WHERE CUR_CODIGO = " + curso;
                    	rs = conexao.executaConsulta(query,session.getId());
                    	if (rs.next()){
							cur_custo = rs.getFloat(1);
							%> <input type="text" name="txtcustocurso" size="10"
							value="<%=ReaistoStr(cur_custo)%>" onKeyUp="numero(this)"
							onblur="numero2();"> <%
						}
						else{
							%> <input type="text" name="txtcustocurso" size="10" value=""
							onKeyUp="numero(this)" onblur="numero2();"> <%
						}
					}
					else{
						pag_cuscur = replaceString(pag_cuscur,",",".");
						cur_custo = Float.parseFloat(pag_cuscur);
						%> <input type="text" name="txtcustocurso" size="10"
							value="<%=ReaistoStr(cur_custo)%>" onKeyUp="numero(this)"
							onblur="numero2();"> <%
					}
					%> (99999,99) + <%=trd.Traduz("CUSTO LOGISTICA")%>: <%=moeda%></td>
						<td class="ftverdanacinza">
						<%
					//out.println(vet_desc);
		    		//out.println(vet_desc.size());
		    		int i=0;
		    		total=0;
		    		while(i < (vet_cust.size())){
		    			aux = (String)vet_cust.elementAt(i); 
		    			float nova = Float.parseFloat(aux);
		    			total = total + nova;
		    			i=i+1;
		    		}

                    if (pag_cuslog.equals("")){
                    	%> <input readonly type="text" name="txtcustolog"
							size="10" value="<%=ReaistoStr(total)%>"
							onKeyDown="FormataCampo(this, window.event.keyCode,'down')"
							onKeyUp="FormataCampo(this, window.event.keyCode,'up')"
							onblur="numero2();"> <%
					}
					else {
						%> <input readonly type="text" name="txtcustolog" size="10"
							value="<%=ReaistoStr(total)%>"
							onKeyDown="FormataCampo(this, window.event.keyCode,'down')"
							onKeyUp="FormataCampo(this, window.event.keyCode,'up')"
							onblur="numero2();"> <%
					}
					%>
						</td>
						<td class="ftverdanacinza" nowrap>= <%=trd.Traduz("Custo Real")%>:
						<%=moeda%></td>
						<%
					float custo_final = cur_custo + total;
					%>
						<td class="ftverdanacinza" colspan="2"><input readonly
							type="text" name="txtcustoreal" size="10"
							value="<%=ReaistoStr(custo_final)%>"></td>
					</tr>
					<%      	  
                  query = "SELECT CUR_DURACAO, EMP_CODIGO FROM CURSO WHERE CUR_CODIGO = " + curso;
                  //out.println(query);
                  rs = conexao.executaConsulta(query,session.getId()+"RS_12");
                  if (rs.next()) {%>
					<tr>
						<td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("DuraCAo")%>:</td>
						<td class="ftverdanacinza" colspan="6">
						<%                    if (pag_duracao.equals("") && pag_duracao2.equals("")) {%>
						<input type="text" name="txtduracao" size="2"
							value="<%=durhora(rs.getFloat(1))%>" onblur="duracao2(this);"
							onKeyUp="duracao(this)">: <input type="text"
							name="txtduracao2" size="2" value="<%=durmin(rs.getFloat(1))%>"
							maxlength="2" onblur="duracao2(this);" onKeyUp="duracao(this)">
						hh:mm <%                    } else {%> <input type="text"
							name="txtduracao" size="2" value="<%=pag_duracao%>"
							onblur="duracao2(this);" onKeyUp="duracao(this)">: <input
							type="text" name="txtduracao2" size="2" value="<%=pag_duracao2%>"
							maxlength="2" onblur="duracao2(this);" onKeyUp="duracao(this)">
						hh:mm <%                    }%>
						</td>
					</tr>
					<%                }
                    
                %>
					<tr>
						<td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Entidade")%>:</td>
						<td class="ftverdanacinza" colspan="6"><select
							name="selectent">
							<%                      String cbo_entidade="";
                        if ((!(pag_curso.equals(""))) && (!(pag_curso.equals("Selecione")))){
                          query = "SELECT EMP_CODIGO, EMP_NOME FROM EMPRESA " +
                                  "WHERE EMP_CODIGO = (SELECT EMP_CODIGO FROM CURSO WHERE CUR_CODIGO = " +pag_curso+ ") " +
                                  "ORDER BY EMP_NOME";
                          rse = conexao.executaConsulta(query,session.getId()+"RS_8");
                          if (rse.next()) {
                            cbo_entidade = rse.getString(1);
                            do {
                              if (pag_entidade.equals(rse.getString(1))) {%>
							<option value="<%=rse.getInt(1)%>" selected><%=rse.getString(2)%></option>
							<%                            } else {%>
							<option value="<%=rse.getInt(1)%>"><%=rse.getString(2)%></option>
							<%                            }
                            }
                            while (rse.next());
                          }
                          if(rse!=null){
                            rse.close();
                            conexao.finalizaConexao(session.getId()+"RS_8");
                            }
                        } else {%>
							<option value="" selected><%=trd.Traduz("Selecione")%></option>
							<%                      }%>
						</select> <%                    //out.println(query);%>
						</td>
					</tr>
					<tr>
						<td class="ftverdanacinza" align="right" height="30"><%=trd.Traduz("Instrutor")%>:</td>
						<td class="ftverdanacinza" colspan="6"><select
							name="selectinst">
							<option value=""><%=trd.Traduz("Selecione")%></option>
							<%                      if (!cbo_entidade.equals("")){
                          query = "SELECT INS_CODIGO, INS_NOME FROM INSTRUTOR WHERE EMP_CODIGO = " +cbo_entidade+ " " +
			          "ORDER BY INS_NOME";
                          rs = conexao.executaConsulta(query,session.getId()+"RS_9"); 
                          if (rs.next()) {
                            do {
                              if (pag_instrutor.equals(rs.getString(1))){%>
							<option value="<%=rs.getInt(1)%>" selected><%=rs.getString(2)%></option>
							<%                            } else {%>
							<option value="<%=rs.getInt(1)%>"><%=rs.getString(2)%></option>
							<%                            }
                            }
                            while (rs.next());
		          }
                          if(rs!=null){
                            rs.close();
                            conexao.finalizaConexao(session.getId()+"RS_9");
                            }
                        }%>
						</select> <%                    //out.println(query +"-"+ cbo_entidade);%>
						</td>
					</tr>
					<tr>
						<td class="ftverdanacinza" align="right"><%=trd.Traduz("ObservaCAo")%>:</td>
						<td class="ftverdanacinza" colspan="6"><textarea
							name="txtobs" rows="4" cols="50" onKeyUp="aspa(this)"
							onBlur="aspa2(this)"><%=pag_obs%></textarea></td>
					</tr>
					<tr>
						<td class="ftverdanacinza" align="center" colspan="7">&nbsp;<br>
						<input type="button" onClick="return enviar();"
							value=<%=("\""+trd.Traduz("Confirmar")+"\"")%> class="botcin"
							name="button"> &nbsp;&nbsp; <input type="button"
							onClick="return cancelar();"
							value=<%=("\""+trd.Traduz("Cancelar")+"\"")%> class="botcin"
							name="button"></td>
					</tr>
					<tr>
						<td class="ftverdanacinza" align="center" colspan="100%">
						<hr>
						</td>
					</tr>
				</table>
				<%              //consulta se existem avaliacoes para o curso, senao nao houver pega as avaliacoes padrao do plano
				if ((!(pag_curso.equals(""))) && (!(pag_curso.equals("Selecione"))))
	           {
                query = "SELECT DISTINCT A.AVA_DESCRICAO, Q.QUE_NOME, Q.QUE_CODIGO, PA.PLV_DIASENVIO, PA.PLV_DIASVENC, PA.CUR_CODIGO, PA.PLA_CODIGO "+
                        "FROM PLANO_AVALIA PA, AVALIACAO A, QUESTIONARIO Q, CURSO C "+
                        "WHERE PA.QUE_CODIGO = Q.QUE_CODIGO "+
                        "AND Q.AVA_CODIGO = A.AVA_CODIGO "+
                        "AND PA.CUR_CODIGO = C.CUR_CODIGO "+ 
                        "AND C.CUR_CODIGO = " +pag_curso+ " "+
                        "ORDER BY A.AVA_DESCRICAO ";
                rs = conexao.executaConsulta(query,session.getId()+"RS_10");
                contem = false;
			   }
                if (rs.next()) contem = true;                
                if(rs!=null){
                    rs.close();conexao.finalizaConexao(session.getId()+"RS_10");
                    }    
                    if (!contem) {
                  query = "SELECT DISTINCT A.AVA_DESCRICAO, Q.QUE_NOME, Q.QUE_CODIGO, PA.PLV_DIASENVIO, PA.PLV_DIASVENC, PA.CUR_CODIGO, PA.PLA_CODIGO "+
                          "FROM PLANO_AVALIA PA, AVALIACAO A, QUESTIONARIO Q "+
                          "WHERE PA.QUE_CODIGO = Q.QUE_CODIGO "+
                          "AND Q.AVA_CODIGO = A.AVA_CODIGO "+
                          "AND PA.CUR_CODIGO IS NULL "+
                          "AND PA.PLA_CODIGO = "+usu_plano+ " "+
                          "ORDER BY A.AVA_DESCRICAO ";
                  rs = conexao.executaConsulta(query,session.getId()+"RS_11");
                  if (rs.next()) contem = true;
                    }
                   
                //out.println(query);
                cont = 0;
                if (contem){%>
				<table border="0" cellspacing="0" cellpadding="0" width="100%">
					<tr align="center" valign="middle">
						<td>
						<table border="0" cellspacing="0" cellpadding="0" width="85%">
							<tr align="center">
								<td class="trontrk" align="center" colspan="100%"><%=trd.Traduz("AVALIACOES")%></td>
							</tr>
							<tr>
								<td>&nbsp;</td>
								<td class="ftverdanacinza" align="left"><%=trd.Traduz("QUESTIONARIO")%></td>
								<td class="ftverdanacinza" align="left"><%=trd.Traduz("DATA ENVIO")%></td>
								<td class="ftverdanacinza" align="left"><%=trd.Traduz("DATA VENCIMENTO")%></td>

							</tr>
							<%                      do {
                        if (!avaliacao.equals(rs.getString(1)) && cont != 0){%>
							</select>
							</td>
							<td align="left" width="20%">
							<%                          if (request.getParameter("txt_dt_envio_"+cont) == null) {%>
							<input type="text" name="txt_dt_envio_<%=cont%>" size="9"
								value="<%=CalendarToString(cal_env)%>"
								onChange="ChecaData(this)"
								onKeyDown="FormataData(this, window.event.keyCode,'down')"
								onKeyUp="FormataData(this, window.event.keyCode,'up')">
							<%                          } else {%> <input type="text"
								name="txt_dt_envio_<%=cont%>" size="9"
								value=<%=("\""+request.getParameter("txt_dt_envio_"+cont)%>
								" onChange="ChecaData(this)"
								onKeyDown="FormataData(this, window.event.keyCode,'down')"
								onKeyUp="FormataData(this, window.event.keyCode,'up')">
							<%                          }%> &nbsp;<img
								onclick="DoCal(txt_dt_envio_<%=cont%>)" style="cursor: hand"
								src="../art/icon_cal.gif" title="CalendArio" WIDTH="17"
								HEIGHT="16"></td>
							<td align="left" width="20%">
							<%                          if (request.getParameter("txt_dt_vencimento_"+cont) == null) {%>
							<input type="text" name="txt_dt_vencimento_<%=cont%>" size="9"
								value="<%=CalendarToString(cal_ven)%>"
								onChange="ChecaData(this)"
								onKeyDown="FormataData(this, window.event.keyCode,'down')"
								onKeyUp="FormataData(this, window.event.keyCode,'up')">
							<%                          } else {%> <input type="text"
								name="txt_dt_vencimento_<%=cont%>" size="9"
								value=<%=("\""+request.getParameter("txt_dt_vencimento_"+cont)%>
								" onChange="ChecaData(this)"
								onKeyDown="FormataData(this, window.event.keyCode,'down')"
								onKeyUp="FormataData(this, window.event.keyCode,'up')">
							<%                          }%> &nbsp;<img
								onclick="DoCal(txt_dt_vencimento_<%=cont%>)"
								style="cursor: hand" src="../art/icon_cal.gif"
								title="CalendArio" WIDTH="17" HEIGHT="16"></td>
							</tr>
							<%                      }
                        if (!avaliacao.equals(rs.getString(1))){
                        cont++;%>
							<tr>
								<td align="left" width="25%" class="ftverdanacinza">
								<%                          if (request.getParameter("chk_"+cont) == null) {%>
								<input type="checkbox" name="chk_<%=cont%>">&nbsp;<%=rs.getString(1)%>
								<%                          } else {%> <input type="checkbox"
									name="chk_<%=cont%>" checked>&nbsp;<%=rs.getString(1)%>
								<%                          }%>
								</td>
								<td align="left" width="35%"><select
									name="cbo_questionario_<%=cont%>">
									<option value="" selected><%=trd.Traduz("SELECIONE")%></option>
									<%                            if (rs.getString(3).equals(request.getParameter("cbo_questionario_"+cont))){%>
									<option value="<%=rs.getString(3)%>" selected><%=rs.getString(2)%></option>
									<%                            } else {%>
									<option value="<%=rs.getString(3)%>"><%=rs.getString(2)%></option>
									<%                            }
                        } else {
                              if (rs.getString(3).equals(request.getParameter("cbo_questionario_"+cont))){%>
									<option value="<%=rs.getString(3)%>" selected><%=rs.getString(2)%></option>
									<%                            } else {%>
									<option value="<%=rs.getString(3)%>"><%=rs.getString(2)%></option>
									<%                            }
                        }
                        avaliacao = rs.getString(1);
                        cal_env.setTime(dataAtual);
                        cal_env.add(Calendar.DATE, rs.getInt(4));
                        cal_ven.setTime(dataAtual);
                        cal_ven.add(Calendar.DATE, rs.getInt(5));
                        } while (rs.next());
                        if(rs!=null) {rs.close();conexao.finalizaConexao(session.getId()+"RS_11");}
                        if (cont != 0){%>
								</select></td>
								<td align="left" width="20%">
								<%                          if (request.getParameter("txt_dt_envio_"+cont) == null) {%>
								<input type="text" name="txt_dt_envio_<%=cont%>" size="9"
									value="<%=CalendarToString(cal_env)%>"
									onChange="ChecaData(this)"
									onKeyDown="FormataData(this, window.event.keyCode,'down')"
									onKeyUp="FormataData(this, window.event.keyCode,'up')">
								<%                          } else {%> <input type="text"
									name="txt_dt_envio_<%=cont%>" size="9"
									value=<%=("\""+request.getParameter("txt_dt_envio_"+cont)+"\"" %>
									onChange="ChecaData(this)"
									onKeyDown="FormataData(this, window.event.keyCode,'down')"
									onKeyUp="FormataData(this, window.event.keyCode,'up')">
								<%                          }%> &nbsp;<img
									onclick="DoCal(txt_dt_envio_<%=cont%>)" style="cursor: hand"
									src="../art/icon_cal.gif" title="CalendArio" WIDTH="17"
									HEIGHT="16"></td>
								<td align="left" width="20%">
								<%                          if (request.getParameter("txt_dt_vencimento_"+cont) == null) {%>
								<input type="text" name="txt_dt_vencimento_<%=cont%>" size="9"
									value="<%=CalendarToString(cal_ven)%>"
									onChange="ChecaData(this)"
									onKeyDown="FormataData(this, window.event.keyCode,'down')"
									onKeyUp="FormataData(this, window.event.keyCode,'up')">
								<%                          } else {%> <input type="text"
									name="txt_dt_vencimento_<%=cont%>" size="9"
									value=<%=("\""+request.getParameter("txt_dt_vencimento_"+cont)%>
									" onChange="ChecaData(this)"
									onKeyDown="FormataData(this, window.event.keyCode,'down')"
									onKeyUp="FormataData(this, window.event.keyCode,'up')">
								<%                          }%> &nbsp;<img
									onclick="DoCal(txt_dt_vencimento_<%=cont%>)"
									style="cursor: hand" src="../art/icon_cal.gif"
									title="CalendArio" WIDTH="17" HEIGHT="16"></td>
							</tr>
							<%                      }%>
							<tr>
								<td class="ftverdanacinza" align="center" colspan="100%">
								<hr>
								</td>
							</tr>
						</table>
						</td>
					</tr>
				</table>
				<%              }%>

				<table border="0" cellspacing="0" cellpadding="0" width="100%">
					<tr align="center">
						<td>
						<table border="0" cellspacing="0" cellpadding="0" align="right">
							<tr>
								<td valign="middle" class="trontrk" align="center" width="100%"><%=trd.Traduz("CADASTRO DE CUSTO LOGISTICA")%></td>
							</tr>
							<tr align="center">
								<td valign="top">&nbsp;&nbsp;&nbsp; <font
									class="ftverdanacinza"><%=trd.Traduz("DESCRICAO")%>:</font> <input
									type="text" name="txt_desc" size="50" onKeyUp="aspa(this)"
									onBlur="aspa2(this)"> &nbsp;&nbsp;&nbsp; <font
									class="ftverdanacinza"><%=trd.Traduz("CUSTO LOGISTICA")%>:
								<%=moeda%></font> <input type="text" name="txt_cust" size="10"
									onKeyUp="numero(this)" onBlur="numero3(this)"> <font
									class="ftverdanacinza"> (99999,99) </font> <br>
								<input class="botcin" type="button"
									value=<%=("\""+trd.Traduz("INCLUIR")+"\"")%>
									OnClick="return insere();"> <input class="botcin"
									type="button" value=<%=("\""+trd.Traduz("EXCLUIR")+"\"")%>
									OnClick="return deleta(<%=origem%>);"> </br>
								&nbsp;&nbsp;&nbsp; <!--<center>-->
								<table border="0" cellspacing="1" cellpadding="0">
									<tr>
										<td>&nbsp;</td>
										<td class="celtittab" width="80%">&nbsp;<%=trd.Traduz("DESCRICAO")%></td>
										<td class="celtittab" align="center" width="20%"><%=trd.Traduz("CUSTO")%></td>
									</tr>
									<%                              //out.println(""+vet_cust);
                                //out.println(""+vet_desc);
                                int a = 0;
                                while(a<vet_cust.size()) {
                                  aux = (String)vet_cust.elementAt(a);
                                  float novo = Float.parseFloat(aux);%>
									<tr>
										<td class="celnortab" align="center"><input
											name="vet<%=a%>" type="checkbox" value="<%=a%>"></td>
										<td class="celnortab">&nbsp;<%=vet_desc.elementAt(a)%></td>
										<td class="celnortab" align="right"><%=ReaistoStr2(novo, moeda)%></td>
									</tr>
									<%                                a=a+1;
                                }%>
									<tr>
										<td colspan="3" valign="top" class="ctvdiv"><img
											src="../art/bit.gif" width="1" height="1"></td>
									</tr>
									<tr>
										<td class="celnortab">&nbsp;</td>
										<td align="right" class="celnortab"><b><%=trd.Traduz("VALOR TOTAL")%>:&nbsp;</b></td>
										<td align="right" class="celnortab"><%=ReaistoStr2(total, moeda)%></td>
									</tr>
									<tr>
										<td>&nbsp;</td>
									</tr>
								</table>
								<!--</center>--></td>
							</tr>
						</table>
						</td>
					</tr>
				</table>
				<input type="hidden" name="total2" value="<%=total%>"> <input
					type="hidden" name="contador" value="<%=a%>"> <input
					type="hidden" name="cont_avaliacao" value="<%=cont%>"> <input
					type="hidden" name="origem" value="1"> <input type="hidden"
					name="limpa_vets" value="N"> <input type="hidden"
					name="deleta_vets" value="N"></center>
				</td>

			</tr>
		</table>
		</td>
	</tr>
	<script language="JavaScript1.1">
    document.frm.txt_desc.focus();
  </script>
	<tr>
		<td align="right" height="30" class="difundo">
		<table width="100%" border="0" cellspacing="0" cellpadding="0">
			<tr>
				<td>
				<%          
				if(ponto.equals(".."))
				{
				%> <jsp:include page="../rodape/rodape.jsp" flush="true">
				</jsp:include> <%          
				}
				else
				{
				%> 
				<jsp:include page="/rodape/rodape.jsp" flush="true" >
				
				</jsp:include>
				<%
				}
				
				if(rs!=null){
    rs.close();
    conexao.finalizaConexao(session.getId()+"RS_12");
}
				%>
				</td>
			</tr>
		</table>
		</td>
	</tr>

</table>
</form>
</body>
</html>